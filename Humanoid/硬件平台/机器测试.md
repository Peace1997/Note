# 一、机械性能

## 1. 电机

### 1. 扭矩系数

扭矩系数 $K_t$（Torque Constant）是一个电机的重要物理参数，用来描述单位电流产生多少输出扭矩。其单位通常为： **Nm/A**
单位电流产生的输出扭矩大小：  
$$\tau = K_t \cdot I$$


>[! NOTE]
大多数无刷电机都会标出：$K_t$（Nm/A）或 $K_v$（rpm/V），然后用下式换算：
$$K_t = \frac{60}{2\pi K_v}$$注意单位一致，$K_v$ 要用 rpm/V，换算后得到 $K_t$ 单位为 Nm/A

**$K_t$ 越大，启动越容易，系统越平稳**；$K_t$ 越小，容易出现**卡顿、迟滞、RL 学不到动作**等问题。

### 2. 堵转扭矩
堵转扭矩（Stall Torque）是电机在**轴被完全阻止转动时**（转速为零）所能输出的最大扭矩（在最大额定电流下产生的最大扭矩）。它反映了电机的“推力极限”，可以帮助我们判断：
- 电机能否驱动目标负载
- 启动阶段是否能克服静摩擦或外部阻力

堵转扭矩与**扭矩常数 $K_T$ 和电流 $I$** 关系如下：
$$T_{\text{stall}} = K_t \cdot I_{\text{stall}}$$
知道堵转扭矩就能反推出扭矩常数或估计最大允许电流。


>[! NOTE] 为何用堵转扭矩计算 $K_T$
>- 没有旋转，转速为零，电机反电动势 $E_b = 0$，反电动势不影响电流和扭矩的关系，$K_T$ 估算更准确


### 3. 过载温升测试
过载温升测试（Overload Temperature Rise Test） 的意义在于评估电机或驱动装置在**高负载或极限使用场景下**的**热承受能力和安全性**，其主要目的是：

- **评估过载能力**
	- 电机并非只能在额定电流下运行，实际使用中可能会因为加速、突发负载等情况短时间过载运行。
	- 过载温升测试用于评估电机在高电流状态下能维持多久而不会损坏或过热烧毁。
- **指导实际使用中的保护策略**
	- 可以为控制器设定更合理的 **过载保护阈值（如温度上限、电流上限）**。
	- 防止过热导致**绝缘材料老化**、**磁钢退磁**、**润滑系统失效**等问题。

 ### 数据参考

| 电机型号    | 减速比 | 额定转速 (rpm) | 最大转速（rpm） | 额定电流 (A) | 额定扭矩 (Nm) | 扭矩常数         |
| ------- | --- | ---------- | --------- | -------- | --------- | ------------ |
| PA 100  |     |            |           |          |           | 1.05         |
| PA 72   | 36  | 30         | 80        | 6.3      | 25        | 4.8~5.0<br>  |
| PA 60   | 36  | 50         | 75        | 4.4      | 14.5      | 3.8~3.95<br> |
| PA 4310 | 25  | 50         | 70        | 1.46     | 6         | 4.7          |



## 2. 减速器

减速器：以速度换扭矩

***高减速比表现：***
- **输出轴更“沉重”**：由于高减速比意味着输入轴要转很多圈才能带动输出轴转一圈，输出轴的角刚度会增大，从而“手掰”时阻力明显上升。
- **机械摩擦/反向力矩放大**：由于结构中的多级齿轮或谐波传动机构，高减速比会放大系统内部的摩擦和反向驱动力矩。
- **有助于稳定性**，但不利于灵活性（特别是需要快速反应或外部扰动时）。


### 1. 减速比 && 转速
减速比定义为 $r = \frac{\omega_{motor}}{\omega_{load}}$，即电机速度（转子本身的角速度） / 负载速度（减速器输出速度）
假设电机空转最高转速为 $n_{motor}$，减速比为 $r$，那么减速器输出端的理论最高转速为：
$$n_{out} = \frac{n_{motor}}{r}$$ 
>- 比如电机最大转速为 6000 rpm，减速比为 100，那输出端最多只有 60 rpm。|   |
| - 1 rpm = $\frac{2\pi}{60}$ rad/s ≈ 0.1047 rad/s


>[! NOTE]
>负载速度是我们真正控制的关节速度， 控制器要控制“负载端”，但通常电机测量的是“电机端速度”

### 2. 减速比 &  力矩

高减速比 = **慢速大力气**
- 优点：更大的输出扭矩、更强抗扰性、更稳定。
- 缺点：响应慢、反向驱动难（你掰不动它）、速度上限低。
低减速比 = **快速但输出扭矩小**

同时，**高转速下的扭矩不需要那么大**，所以高速运动一般采用低减速比甚至直驱方案。

### 3. KP、KD 设置

对于减速比较大的机械臂关节，在设置 PD 控制器的 $K_p$（比例增益）和 $K_d$（微分增益） 时，需要根据其动力学特性进行特殊考量。

因为高减速比意味着：
- 输出关节更“刚硬”（stiff）；
- 反向驱动难（低回传性）；
- 摩擦力、齿隙、静态粘滞等效应更显著；
- 但同时**关节的惯量经过减速器“放大”很多倍，等效动响应变慢**。

因此在设置时：
 1. **减速比大时 $K_p$ 不宜太高**
	- 高减速比本身已经引入了**较强的机械刚度**；
	- 如果 $K_p$ 设置过高，容易导致系统：
	    - 出现高频振荡；
	    - 控制信号过大（尤其是控制器输出的力矩超出实际可控范围）；
	    - 触发过度摩擦与冲击；
	    - 高频伺服噪音甚至发热严重。
	    - 
	因此，**适中或偏低**的 $K_p$ **，让减速器的“物理刚度”来承担部分作用。
	
2. **$K_d$ 比例相对提高，KD 提供“速度误差阻尼”，有助于抑制慢响应和震荡**
	由于高减速比系统惯量大，动态响应慢，**更依赖阻尼来稳定系统**。
	- 适当提高 $K_d$ 有助于：
	    - 提高控制系统的阻尼；
	    - 避免欠阻尼导致的震荡；
	    - 提高系统对外部扰动（如碰撞、摩擦突变）的抑制能力。
	 因此，**$K_d$ 取值可适度偏高，或根据系统响应做微调**

大减速比 → 等效惯量大 → 更容易震荡、滞后，需要 $K_d$ 补偿

### 4. 等效惯量

在带有减速器的系统中，负载的惯量不会直接作用在电机轴上，而是**通过减速比“折算”回电机轴**，形成一个“等效惯量”。

1. ***电机侧惯量：***
控制器 (电流环/速度环设计），通常是电机侧的建模：
$$J_{eq\_motor} = J_{motor} + \frac{J_{load}}{r^2}$$​​
其中：
- $J_{eq\_motor}$：电机侧的等效惯量；
- $J_{motor}$：电机转子的自身惯量；厂家给出
- $J_{load}$：负载侧的转动惯量（通常是输出轴负载、机械臂等）；
- $r$：减速比；

2. ***关节端惯量***
机器人关节动力学分析（自然频率/阻尼比/带宽），通常用关节输出端惯量，
$$
J_{eq\_load} = J_{motor}N^2 + J_{link}
$$
- $J_{eq\_load}：$ 关节末端负载侧的等效惯量
- $J_{link}$：负载/连杆惯量，指安装在减速器输出端的所有负载（机械臂连杆、末端执行器、外部负载等）对关节轴的转动惯量。CAD 或动力学建模

---
3. ***物理意义***

- 减速器的作用是以牺牲速度换取力矩；
- 而在惯量上，它使得负载“看起来更轻”了， **减速比越大，折算到电机侧的惯量就越小**
- 这解释了为什么高减速比的系统尽管负载很大，但对电机来说启动变得容易（代价是速度慢、反向驱动难）。

---

4. ***举例说明***

假设：

- 负载端惯量 $J_{load} = 1.0\ \text{kg·m}^2$；
- 电机转子惯量 $J_{motor} = 0.01\ \text{kg·m}^2$；
- 减速比 $r = 10$；

则电机侧的等效惯量为：

$$J_{eq} = 0.01 + \frac{1.0}{10^2} = 0.01 + 0.01 = 0.02\ \text{kg·m}^2$$

可见：**一个很重的负载，通过减速器折算后对电机来说“仅相当于”0.01的惯量。**

如果你可以计算或估算关节的**等效转动惯量 $J_{eff}$** 和 **期望的自然频率 $\omega_n$ 与阻尼比 $\zeta$**，那么可以使用标准二阶系统公式：

4. ***等效惯量与 KP、KD***
$$K_p = J_{eq} \cdot \omega_n^2$$$$K_d = 2 \cdot \zeta \cdot \omega_n \cdot J_{eq}$$
其中：
- $\omega_n$：期望的自然频率（rad/s），决定响应速度，通常在 $2\pi \cdot (1 \sim 5)$ rad/s；
- $\zeta$：阻尼比，决定系统是否振荡，，通常在 $0.7 \sim 1.2$；
- $J_{eq}$：等效到电机轴的总惯量 = 电机惯量 + 负载惯量 / (减速比)^2。


> [! NOTE] PD 控制器二阶系统建模
一个典型的二阶系统形式如下：
$$J_{\text{eq}} \ddot{\theta}(t) + B \dot{\theta}(t) + K \theta(t) = \tau(t)$$
>- $J_{\text{eq}}$​：等效转动惯量（kg·m²）
>- B：等效阻尼（N·m·s/rad），若没有物理阻尼，可忽略
>- K：刚度，若只用 PD 控制器代替弹性机械结构刚度，那么由 KP 控制器产生
>- $\tau(t)$：施加的控制扭矩
>- $\theta(t)$：角度
若你使用如下形式的PD控制器：
$$\tau(t) = K_P \cdot e(t) + K_D \cdot \dot{e}(t)$$
代入控制系统，可以得到系统的闭环传递函数：
$$\frac{\Theta(s)}{\Theta_{\text{ref}}(s)} = \frac{K_P}{J_{\text{eq}} s^2 + K_D s + K_P}$$
这个形式就是经典的**标准二阶系统**：
$$\frac{\omega_n^2}{s^2 + 2 \zeta \omega_n s + \omega_n^2}$$

​​
## 3. 带宽

**带宽**（Bandwidth）是一个**衡量系统响应速度和动态性能的核心指标**。它告诉我们：

> **系统能在多快的频率范围内“准确地”跟随输入信号变化。**

控制系统的**带宽越高**，表示它响应越快、能追得上越快的指令变化。


### 1. 频率域
对于一个线性系统的频率响应函数 $G(j\omega)$：
- 带宽是指**系统增益从最大值下降 3 dB（约为原始值的 70%）的位置对应的频率**；
- 记为 $\omega_{bw}$，单位为 **rad/s** 或换算为 **Hz**（$f_{bw} = \omega_{bw}/(2\pi)$）；

也就是：
 - 输入是正弦信号 $\sin(\omega t)$；
- 系统能“稳定地、不变形地”跟随输入的最大 $\omega$，就是带宽。

### 2. 带宽和自然频率的关系（PD 控制下）

在 PD 控制器下，二阶系统的自然频率与带宽近似相关：
- 对系统模型 $J \ddot{q} + K_d \dot{q} + K_p q = \tau$，
- 自然频率：$\omega_n = \sqrt{\frac{K_p}{J_{eq}}}$
- 阻尼比：$\zeta = \frac{K_d}{2 \sqrt{J_{eq} K_p}}$
- 系统带宽近似 $\omega_{bw} \approx \omega_n$

也就是说，**你加大 $K_p$，系统刚性变强，带宽变大，响应更快**。


## 4. KP、KD 调节

### KP/KD 比值
通过之前的 KP、KD 的计算可知：对于一个二阶系统，用 PD 控制器你有：$$\begin{cases} K_p = J\,\omega_n^2,\\ K_d = 2\,\zeta\,\omega_n\,J, \end{cases}$$​
直接把两式相除：

$$\frac{K_p}{K_d} = \frac{J\,\omega_n^2}{2\,\zeta\,\omega_n\,J} = \frac{\omega_n}{2\,\zeta}.$$
**所以，**
$$\boxed{K_p : K_d \;\approx\; \omega_n : 2\zeta\,\,.}$$

- 这个比值只跟你**想要的带宽 $\omega_n$​** 和**想要的阻尼 $\zeta$** 有关，和惯量 J 无关。

***与减速比的关系***
若你不变动动控制增益，只增大减速比 r：

$$J_{\rm eq\_motor} = J_{\rm load}/r^2.$$
更高 r → 更小 $J_{\rm eq\_{motor}}$​ → 在同一套$K_p,K_d$，系统的自然频率会升高，阻尼比也会随之变小
$$J_{\rm eq\_{}}↓  → \zeta = K_d/(2\sqrt{J_{\rm eq}K_p}) ↓  $$

==**减速比越大，想要手动转动输出轴就越困难**，所以 **大减速比反而会降低阻尼比**（更易振荡），若 KP 固定，**若想要在大减速比下保持或提高阻尼比**，就得 **相应提高 Kd**。==

 ### KP、KD 调节

| 现象                           | 诊断                         | 操作         |
| ---------------------------- | -------------------------- | ---------- |
| 1. 低频大幅振荡（来回晃动、超调后反复-几度到十几度） | 阻尼不足（$\zeta$ 过小）           | 增大 Kd      |
| 2. 缓慢收敛、跟踪误差大，无振荡            | 刚度不足或阻尼过大（$\zeta$ 过大）      | 增大 Kp      |
| 3. 高频小幅抖动／噪声                 | 微分噪声放大（q˙\dot q 信号抖动被过度放大） | 减少 Kd 或加滤波 |
| 4. 响应太快但稍有震荡，收敛快             | 阻尼略不足                      | 轻微增大 Kd    |

- **见到“慢速大摆动”**，先检查阻尼不足——**增大 Kd​**；
- **见到“细碎快速颤抖”**，先检查噪声放大——**降低 Kd​** 或**给速度环加低通滤波**。


## 初始整机测试
0.
模式场景：机器人悬空，被动模式（关节通弱电，电机轴不使能）
测试内容：检查关节反馈量；IMU 姿态，角速度，线加速度方向以及量纲；检查系统层，算法层录数据
功能，在线+离线
1.
模式场景：机器人悬空，所有关节
测试内容：检查关节零位，方向，各指令量纲
2.
模式场景：机器人悬空，无传动机构的单关节运动测试
测试内容：所有关节 PVT 控制测试（纯力矩 T 控制）；关节空间轨迹跟踪，如 $$\theta_{cmd,i}=A_{i}sin(\frac{2\pi}{T}t)+\theta_{0,i}$$
3.
模式场景：机器人悬空，有传动机构的单关节运动测试
测试内容：传动（并联）关节 PVT 控制；串联算法模块外的指令收发封装
4.
模式场景：机器人悬空，多关节+关节空间+正弦轨迹跟踪
测试内容：多关节 PVT 同时运动测试；系统稳定性，时钟，关节顺序，散热
5.
模式场景：机器人悬空，多关节+关节空间+离线轨迹跟踪（如仿真中提取步态关节轨迹）
测试内容：悬空行走，关节指令由仿真导出，低、中、高速步态。看整机稳定性
6.
模式场景：机器人悬空，多关节+工作空间+固定基 WBC
测试内容：悬空行走，WBC 控制固定基机器人运动。看算法耗时、看工作空间跟踪误差

