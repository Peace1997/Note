#### **1- Bound Controller for a Quadruped Robot using Pre-Fitting Deep Reinforcement Learning** 浙大具体团队

**Anqiao Li , Zhicheng Wang , Jun Wu , Qiuguo Zhu** 

- Anqiao Li and Zhicheng Wang are with the Institute of Cyber-Systems and Control, Zhejiang University

- Jun Wu and Qiuguo Zhu are with State Key Laboratory of Industrial Control Technology and the Institute of Cyber-Systems and Control, Zhejiang University

浙江大学先控所 (Institute of Cyber-Systems & Control Zhejiang University)

浙江大学工业控制技术国家重点实验室 

吴俊、朱秋国（智能系统与控制研究所）

地址：浙江大学玉泉校区 （控制科学与工程学院）



注：发表在**SCIENCE ROBOTICS**文章的是浙大：**Multi-expert learning of adaptive legged locomotion** 与英国爱丁堡大学合作的发表的文章，浙大的作者是 朱秋国（智能系统与控制研究所）



#### 2- **Learning Free Gait Transition for Quadruped Robots via Phase-Guided Controller** 是否是自己研发的机器人



 Black Panther 基于MIT mini cheetah （**所有软件, 固件,** 除机器人本体外的**硬件已经全部公开**。2019）研发的

<img src="img/Mini Cheetah .png" alt="Mini Cheetah - ROBOTS: Your Guide to the World of Robotics"  />

![image-20220703105324833](img/Black Panther.png)

Yecheng Shao、Yongbin Jin、Xianwei Liu、 Weiyan He、Hongtao Wang、 Wei Yang  2022.1

由杨卫院士牵头创建“交叉力学（X-Mechanics）研究中心”







#### 3- 各仿真平台优缺点对比

仿真平台优点：运行速度快、可并行、方便重置

仿真平台实现功能：

- 物理引擎；对物理现象进行真实建模的物理引擎

  > 物理引擎只是机器人模拟器组成的重要部分之一

- 碰撞检测和摩擦模型

- 图形用户界面（GUI）

- 导入场景和模型（meshes）的能力

- 常用编程语言（C++ / Python）的API

- 随时可用的一系列关节、执行器、传感器的模式



仿真环境运行速度快于实际速度



**Gazebo：**

Gazebo是目前最广泛使用的仿真环境，提供了ROS接口，简化了在模拟中测试控制软件和将其转移到物理系统中的过程，为许多常用的传感器提供了模型库（GPS、camera、IMU）。可以利用 digital elevation models, SDF meshes, and OpenStreetMap 导入各种环境，也可以利用URDF（Universal Robot Description Format）文件导入机器人模型，Gazebo是一个刚体模拟器（rigid-body simulator），可以实时模拟多个机器人，虽然Gazebo本身不提供运动规划功能， 但是它与ROS紧密集成，它可以使用ROS的路径规划器。



Gazebo最早在2004年由USC Robotics Research Lab（南加州大学机器人实验室）开发。Gazebo可在Linux，Windows和Mac上运行，并且内置了对ROS（机器人操作系统）的支持。Gazebo支持多种高性能物理引擎，例如ODE，Bullet，Simbody和DART。Gazebo的功能包括：动力学仿真、传感器仿真、三维环境仿真、训练AI系统，同时支持多种机器人模型。可以利用 digital elevation model (DEM), SDF meshes, and OpenStreetMap (OSM) 导入各种环境，也可以利用URDF（Universal Robot Description Format）文件导入机器人模型，Gazebo是一个刚体模拟器（rigid-body simulator），可以实时模拟多个机器人，虽然Gazebo本身不提供运动规划功能， 但是它与ROS紧密集成，它可以使用ROS的路径规划器。



**CoppeliaSim**

以前称为V-REP，与Gazebo相似也是一个刚体模拟器，可以实时模拟多个机器人，同时也提供了常见的移动机器人平台和传感器的模型库（2D/3D laser, accelerometer, stereo- camera, camera, event camera, GPS, and gyro（gyroscope陀螺仪、又叫角速度传感器）），CoppeliaSim 通过常用的OMPL库（运动规划库）来提供路径规划功能，并支持高度域的地形规范（height-fields for terrain specification.）。

> OMPL是MoveIt默认调用的用于实现运动规划的开源库



**Webots**

开源模拟器，常用于研究：追踪非人体工程学机器人轨迹的性能和进化双足机器人的步态，提供了许多关于移动机器人、环境和传感器的模型数据库，其中传感器包括：accelerometer, camera, compass, GPS, inertial measurement unit, LIDAR, and radar，支持openDriver文件格式导入地图。



**Raisim**

苏黎世理工大学开发的一个刚体物理模拟器，常用于研究腿部平台的动态策略。允许使用高度地图图像（height-map images）来导入不平整地图。

Raisim 是ETH Robotic Systems Lab开发的物理引擎，是未开源的，如果使用该平台需要进行申请，如果用于学术申请是免费的。RaiSim更适合于模拟脚和地面之间的硬性接触，而且速度大为提高，自我定位中，需要一个精确的积分方法，Raisim只使用欧拉方法，它不能处理我们问题中复杂的非线性因素。

> ‡The same training algorithm can run up to 10x faster using RaiSim. However, the simulation throughput depends more on interfacing than the actual simulator. Our training algorithms use Python libraries, while both simulators are written in C++. RaiSim comes with the RaiSimGym library, which allows the entire environment to be written in C++ and requires much less data copying.



**Pybullet**

适用于大多数移动机器人的应用，支持刚体仿真，可能比实时模拟多个机器人更快。，常用与模拟四足机器人的运动策略，并将其从模拟环境转移到现实平台。它支持导入高度场（height-fields），用于地形几何规范，

缺点：不过支持的传感器较少，只支持camera和几个较少使用的传感器。

Pybullet 全称Bullet Real-Time Physics Simulatio，是基于Bullet引擎的面向Python用户的机器人模拟环境，Bullet引擎由谷歌在维护，支持加载URDF，SDF，Mujoco的MJCF等文件格式。PyBullet提供正、逆动力学计算、正、逆运动学、碰撞检测和射线相交查询。Pybullet Gym则是在Pybullet之上构建的，对OpenAI Gym各种机器人强化学习任务的移植。缺点是传感器较少，目前可用的有力矩传感器、Lidar、RGBD，通过提供的API可以获取关节位置和速度信息，没办法获取加速度信息。

参考：

https://docs.google.com/document/d/10sXEhzFRSnvFcl3XxNGhnD4N2SedqwdAvK3dsihxVUA/edit#heading=h.wt1r3kfuctym





**MuJoco**

MuJoCo ，全称Multi-Joint dynamics with Contact，2021年10月18日DeepMind收购并开源了MuJoCo软件（之前都是收费的，最早由Roboti LLC开发）。MuJoCo可用于实现基于模型的计算，如控制综合、状态估计、系统辨识、机构设计、通过逆动力学进行数据分析，以及用于机器学习应用的并行采样。MuJoCo 可以加载其原生MJCF格式的 XML 模型文件，以及URDF 文件格式，URDF的mesh文件通常有两类：包含材质颜色等信息的dae文件（非必须）与用于碰撞的stl文件。由于MuJoCo并不支持dae文件，只支持stl文件，因此，如果URDF模型中有dae文件，需要全部转换为stl文件。OpenAI 宣布开源mujoco-py一个高性能的 Python 库，它可用于使用 MuJoCo 引擎的机器人模拟。由于Mujoco本身就是针对强化学习训练的，所以在运行效率方面优化得比较不错。

常用于机械臂的操作模拟，

缺点：缺乏对反向运动学和路径规划的支持。



**Nvidia Isaac** 

使用Nvidia Flex（基于GPU的物理引擎）作为物理引擎，可以在单个CPU和GPU上在16分钟内学习人形机器人的行走策略。Flex 还支持分布式GPU模拟，可进一步减少训练时间，



NVIDIA Isaac是NVIDIA发布的一款专为机器人打造的系统，也可以在AWS，Google Cloud或Azure上的云中运行。它还支持Jetson TX2、Jetson Nano、Jetson AGX Xavier 和Xavier NX。由于ISAAC机器人技术平台是由NVIDIA制造的，因此它提供了所有机器人模拟仿真器中最好的图形。使用Nvidia PhysX（基于GPU的物理引擎）作为物理引擎，Nvidia对该物理引擎进行了开源，



**综合：**

在 Gazebo、V-Rep 和 Webots 中运行类似人形机器人的模拟表明，Gazebo 比其他两个模拟器更占用 CPU 资源，而 Webots 是这三个模拟器中占用最少的。

模拟器精度的进步是模拟器技术进步的重要一步，建立良好模型的最多的现象是接触（contact），随着碰撞检测和解决方法的改进，可能会出现很大的改进。

![image-20220703164847291](img/compare.png)





| 仿真器        | 开源     | 系统支持 | 物理引擎支持             | ROS支持 | Python版本 | 优点                            | 缺点            |
| ------------- | -------- | :------: | ------------------------ | ------- | ---------- | ------------------------------- | --------------- |
| Gazebo        | 开源     |  Linux   | ODE/Bullet/Simbody/DART  | 支持    |            |                                 | CPU占用高       |
| CoppeliaSim   | 开源     |          | Bullet/ODE/Vortex/Newton | 支持    |            |                                 |                 |
| Webots        | 开源     |          | ODE                      | 支持    |            |                                 | 不支持并行模拟  |
| RaiSim        | 未开源   |          | RaiSim                   |         |            |                                 | 未开源          |
| MuJoCo        | 开源     |          | Mujoco                   | 不支持  |            | 强化学习API易用性好、运行效率高 | 文件导入受限    |
| Pybullet      | 开源     |          | Bullet                   | 不支持  |            | 强化学习API易用性好             |                 |
| Nividia Isaac | 部分开源 |          | PhysX                    | 支持    |            | 图形表现好                      | Isaac sim未开源 |



webots若想进行并行仿真，需要开启多个实例，与GUI绑定，需要占用更多的内存。

![image-20220704093438359](img/compare2.png)

> Collins J, Chand S, Vanderkop A, et al. A review of physics simulators for robotic applications[J]. IEEE Access, 2021, 9: 51416-51431





### 4- 强化学习加速训练

#### CPU

通常来说，智能体与环境的交互这一部分是在CPU中进行的（observation、reward、action），

python底层是基于C的伪多线程，说是多线程实际上是挂了一个全局锁的单线程。加了一些线程切换反而会变慢，这时候需要用多进程去加速。

**同步采样**

首先将多个 **CPU核心** 与 **单个GPU** 相关联，多个模拟器在CPU内核上以**并行进程**运行，并且这些进程以同步方式执行环境步骤，在每个步骤中，将所有单独的观察结果收集到批处理中以进行推理，在提交最后一个观察结果后在GPU上调用该批处理。





MuJoCo等环境用CPU去支持物理引擎的计算，由于CPU算力有限，因此一个物理引擎里放上一个智能体已经让env.step的计算耗时变得足够慢了

而Isaac Gym 把这些计算搬到了GPU上，然后利用GPU的并行计算优势，往物理引擎里放上上千个智能体



#### 5- 强化学习直接与物理环境进行训练的机理

任务：能翻转，站立，最后向前以特定速度行走

效果：训练一小时，能学会全部动作。训练前五分钟，机器人用背部着地翻滚，尝试用脚着地，25分钟，学会站立，一小时学会向前以特定速度行走。10分钟额外训练后学会被棒子击倒后起身。

**状态**：各电机的角度、方向、角速度

**奖励**：

- 直立奖励（匹配站立姿势的项是由臀部、肩部和膝部的关节角计算出来的）

- 前向速度 & 总速度

**动作**： 电机的角度、方向、角速度

人为干预：由于空间限制：当机器人到达可用训练区域的末端时，我们会进行手动干预，而不修改机器人所处的关节配置或方向。



缺点：需要必要的人为干预、直接在机器上训练会损害机器。目前没办法完成一些复杂环境的探索







#### 加速深度学习训练的方法

- 并行模拟：在一个环境中模拟多个机器人，或通过多线程//多进程并行运行多个模拟环境
- 无界面软件运行
- 快速力学求解器

使模拟环境运行速度高于实时







通常具有的传感器：

LiDAR, stereo-camera, GPS, or IMU



狭义上，一个IMU 内在正交的三轴上安装陀螺仪和加速度计，一共 6 个自由度，来测量物体在三维空间中的角速度和加速度，这



四足机器人：三个驱动自由度，即髋部外展/内收、髋关节屈/伸、膝关节屈/伸。

