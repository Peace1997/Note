
# 一、机械系统

## 1. 基本物理概念

1. **质量：** 物体的固有属性，描述其**惯性**大小。 
2. **惯量：** 物体对其运动状态（速度、方向）的**保持能力**，体现了物体“**抗变化性**”。在转动系统中，惯量则通过转动惯量来体现。
3. **转动惯量：** 描述物体对**旋转运动的抗拒能力**，即物体在旋转运动中的“惯性”表现。转动惯量取决于物体的质量及其相对于旋转轴的分布，通常用 $I$ 或者 $J$表示，单位为 **$kg ⋅ m^2$**, 对于一个点质量 m 距离旋转轴的距离 r ，转动惯量为：
$$ I = m ⋅ 
r^2$$
4. **力矩：** 使物体发生旋转的力的效果。力矩通常用 $M$ 或 $\tau$ 表示，单位为 $N \cdot d$。力矩的大小与力 F 与力臂 d（力作用点到旋转轴的垂直距离）的乘积：
$$
\tau = F \cdot d
$$

转动惯量与力矩和角加速度之间有类似于牛顿第二定理的关系：
$$\tau= I ⋅ \alpha$$

## 2. 常用物理参数



机械性能：
- 减速比
- 扭矩常数
- 最大持续/瞬时扭矩
- 最大峰值转速
- 传动效率




# 二、电机

电机（Motor）是一种**将电能转换为机械能**的设备，主要用于驱动机械运动。电机主要负责提供旋转动力，能量来源是电能，输出高转速但低扭矩。

## 1. 电机动力学建模

电机的动力学模型一般可以用下面的运动方程表示：
$$
J \frac{d\omega}{dt} + B \omega + C \operatorname{sign}(\omega) = T_e
$$

其中：
- $J$是电机的转动惯量。
- $\omega$是电机的角速度。
- $B$是粘性摩擦系数。
- $C$是库仑摩擦力。
- $T_e$是电机的电磁转矩，可通过转矩常数$k_t$和电流$I$得到：$T_e = k_t I$（这里假设电机是理想的无铁损或无杂散损耗）。

通过实验数据测量$\omega$和$I$，可以建立方程来求解$J$、$B$和$C$等参数。

## 2. 电机参数辨识

### 惯量辨识

**开环加速法：** 
1. 通过给电机施加一个已知的**恒定电流**，使电机产生恒定的电磁转矩，在电机启动阶段，摩擦力对速度变化的影响比较小，因此可以忽略，
2. 然后记录**电机角速度**随时间的变化，直至电机达到稳定速度。
电机模型可以简化为：
$$
J \frac{d\omega}{dt} \approx  T_e
$$
其中$\frac{d\omega}{dt}$ 可以通过实验测量得到。

注：惯性负载越小，达到稳定速度越快
> 在电机系统中，惯性负载的影响直接体现在系统的动力学上。惯性负载的大小由其**转动惯量**来描述，转动惯量越大，需要的驱动力矩越大。


### 摩擦辨识
在确定惯量 J 之后，可以进一步辨识摩擦系数：
1. 以不同**恒定速度**运行电机，记录电流 I （转矩$T_e=k_tI$）, 在恒定速度时，惯量项$J \frac{d \omega}{dt}$可以忽略不计
2. 在多个不同恒定速度下重复实验，可以得到一组方程，进而解出粘性摩擦系数 B 和库伦摩擦力 C
$$
B \omega + C \text{sign}(\omega) = T_e
$$
3. 由于实验数据往往会受到噪声或测量误差的影响，因此直接解得的 B 或 C 值可能并不准确或存在偏差。因此可以**通过线性回归拟合**，能够更好地处理实验数据中的误差和噪声，使估计的值更具鲁棒性。

==拟合过程本质上是将所有实验数据点平均化==

### 梯度下降法或最小二乘法优化辨识

如果实验数据较多且存在噪声，可以建立误差函数：
$$
\text{误差} = \sum_{i} \left( J \frac{d\omega_i}{dt} + B \omega_i + C \operatorname{sign}(\omega_i) - T_{e_i} \right)^2
$$
使用梯度下降或最小二乘法来求解，使误差最小，从而优化得到 J、B 和 C




# 四、摩擦特性

摩擦力是机械系统中的一种普遍现象，在电机控制、机器人控制等领域会影响系统的精度和性能。常用的摩擦模型可以分为几种典型的摩擦特性：

## 1. 库仑摩擦
库仑摩擦，也称为干摩擦，是系统在低速或静止时的主要摩擦力，表现为一个恒定的力，其方向与运动方向相反。库仑摩擦力的大小仅与接触面性质有关，与相对速度无关。库仑摩擦的模型可以表示为：

$$
F_c = F_{c_0} \cdot \text{sgn}(v)
$$
其中：
- $F_{c 0}$ 为库仑摩擦力的大小。
- $\text{sgn}(v)$ 表示速度的符号函数，库伦摩擦方向总是与速度相反。

**机器人训练目标**：库仑摩擦力与机器人动作方向相反并且在低速时更显著。训练时，可以通过随机化库仑摩擦系数，使机器人能在不同水平的干摩擦环境中学会控制。

## 2. 粘性摩擦
粘性摩擦与速度成正比，通常在较高速度时起主要作用。粘性摩擦可以由流体介质引起，例如润滑油或空气阻力。它的模型为：
$$
F_v = B \cdot v
$$
其中：
- B为粘性摩擦系数。
- v  为相对速度。

粘性摩擦随着速度增大而增大，特别在液体或气体介质较多时（如液压系统）较为明显。

**机器人训练目标**： 粘性摩擦力随速度增加而增大，模拟了与流体接触或高阻力表面上的摩擦力。在训练中引入随机化的粘性摩擦系数，可以模拟不同的阻尼环境，例如湿滑地面、沙地等，逼迫机器人在不同速度下调整姿态和控制策略。

## 3. 静摩擦
静摩擦又称为启动摩擦，是物体刚开始移动时需要克服的摩擦力，通常大于库仑摩擦。当物体静止时，静摩擦力随着施加的外力增大，直至达到某个最大值，物体才会开始滑动。静摩擦的模型可以表示为：
$$
F_s = F_{s 0}, \quad \text{当} \ v = 0 \ \text{且外力小于} \ F_{s 0}
$$
其中 $F_{s 0}$ 为最大静摩擦力。静摩擦使得系统在启动和低速移动时会受到较大的阻力。

**机器人训练目标：** 静摩擦会在机器人启动或停止时对控制产生影响，特别是在起步和变换步态时。通过随机化静摩擦力，可以模拟起步的困难程度，使机器人学会应对更复杂的启动和变速过程。

## 4. 桑顿效应

桑顿效应描述了速度对摩擦力的影响，尤其在低速下显著。其特点是：当速度刚开始增加时，摩擦力先减小，表现出“负阻尼”现象。桑顿效应一般用于描述摩擦力**在低速时逐渐从静摩擦力过渡到库仑摩擦力**的情况，通常表示为：
$$
F = (F_s + (F_c - F_s) e^{-\alpha |v|}) \cdot \text{sgn}(v) + B \cdot v
$$
其中：

- $F_s$​ 为最大静摩擦力。
- $F_c$ 为库仑摩擦力。
- $\alpha$ 是调节桑顿效应的系数，决定摩擦力随速度变化的快慢。

桑顿效应广泛用于描述润滑条件下的摩擦特性，如**滚珠丝杠等机械系统**，特别是在电机和精密机械控制中。


## 5. 人形机器人常用摩擦

### 动态摩擦

**动态摩擦力**：某些地面摩擦力不是恒定的，而是随着时间、温度或接触区域变化，例如摩擦力逐渐减小或增大。通过让**摩擦力随时间逐渐变化**（线性或非线性变化），可以让机器人在逐渐改变的摩擦环境中适应运动，特别是应对长时间行走或长距离行驶的情境。

**动态摩擦方向**： 摩擦力的方向通常与运动方向相反，但在一些不平整地形或障碍物情况下，**摩擦力方向可能会偏离运动方向**。可以设置摩擦力方向的随机扰动，使机器人学会在非标准摩擦力方向下的稳定行走和控制。
### 关节摩擦力

人形机器人的关节摩擦力会影响每个关节的运动特性。**可以对不同关节分别随机化其摩擦参数**，例如让髋关节和膝关节的摩擦系数不同，从而训练机器人适应不同的摩擦分布，尤其在腿部发力不均匀时的控制。

### 滑动摩擦与滚动摩擦

在部分情况下，可以通过随机设置滑动摩擦与滚动摩擦的比例，模拟不同类型的摩擦接触，比如平地行走和台阶行走间的摩擦变化。滚动摩擦更小，而滑动摩擦较大。

## 摩擦随机化设定

- **库仑摩擦**：在0.2到0.5之间随机化，这适用于大多数室内外表面。
- **粘性摩擦**：一般在0.01到0.1 N·s/m之间，对于湿滑表面（如潮湿泥地）可设置为较高的范围。
- **静摩擦**：设置在0.3到0.6之间。对粗糙或黏性表面，范围可以设大一些，以应对起步时的阻力。
## 总结
- **库仑摩擦**：与速度无关，方向与运动方向相反。
- **粘性摩擦**：与速度成正比，阻力随速度增加。
- **静摩擦**：启动时的摩擦力，通常大于库仑摩擦。
- **桑顿效应**：描述摩擦力随速度变化的非线性特性，尤其在低速时。

这些摩擦特性在机械和电机控制系统中广泛存在，选择合适的摩擦模型可以提高系统的控制精度和响应性能。

# 四、关节偏置

 **关节偏置本质上是“编码器读数 ≠ 真实关节角”的系统误差**，来源于装配误差、传动误差、传感器误差与标定误差。它会导致 **运动学误差、动力学误差、控制性能下降**，在高精度控制和 sim-to-real 场景中影响尤其严重。
 
***（1）误差来源***
关节偏置通常指的是 **实际关节角度与传感器（编码器）读数之间的零点或刻度差异**。它的来源主要有以下几类：
- **装配与安装误差**
    - 编码器和电机轴、减速器输出轴之间并非绝对同心，装配时可能存在几度以内的偏移。
    - 编码器零位标定（出厂或人工标定）不准确，导致零点存在偏置。
- **机械传动误差**
    - 关节中若存在齿轮传动或谐波减速器，装配时的预紧角、齿隙残余可能导致零点不在真实的“几何零位”。
    - 长期运行后，齿隙磨损或键连接松动会产生小幅的相位偏移。
- **传感器非理想性**
    - 编码器分辨率有限、非线性误差（尤其是磁编码器）导致零点有系统偏差
    - 编码器信号受温度漂移或电磁干扰影响，读数与实际存在恒定偏置。
- **标定/校准误差**
    - 在机器人装配完成后，需要将**机械零位与编码器零位对齐**，若此过程不精确，就会遗留偏置。
    - 多自由度机器人在进行 **全身标定** 时，由于姿态估计或测量工具的误差，也可能引入系统性偏置。

***（2）解决方法***
关节偏置本质上是“编码器读数/零位相对于真实几何零位的恒定或慢变误差”。在仿真里可以把它作为**域随机化参数**（domain randomization）加入训练，常见实现方式有三种：
1. **传感器层随机化（在 observation 上）**
    - 在仿真中，把 policy 能看到的关节角度 `q_meas = q_true + b_j`（每关节加上偏置 b_j）。
    - 优点：模拟真实系统中编码器的零点误差或偏移，policy 必须在带偏差的感知下仍然稳健。
    - 常用于“blind policy”（仅本体感知）的训练。
   
2. **命令/控制目标层随机化（在 action/targets 上）**
    - 在仿真发送到低层控制器的目标位置上加偏置：`q_target = q_cmd + b_j`。
    - 这等价于仿真中驱动端与机械零位不一致，policy 发出的偏移量在硬件上产生不同实际角度。
    - 有助于训练 policy 对执行偏差的鲁棒性。

# 五、IMU

YIS320

Lord CV7

YIS 320：
- 俯仰角度为±90°，因此机器人躯干方向朝地时，识别不了
- 输出频率为200Hz

与 Lord CV7 对比：
https://microstrain.com/sites/default/files/3DM%20CV7%20Data%20Sheet_0.pdf
- CV7 俯仰角度为±180°
- 输出频率为 500 Hz
- 有磁力计
- 输入电压 3.2-5.2V，范围更宽
- 偏置不稳定度、加速度噪声密度，相比YIS320好一些
- 陀螺仪噪声密度，相比YIS320好很多
- CV7价格数千元，YIS320价格数百元，价格相差很大