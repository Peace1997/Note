

# PACE：离线辨识+零样本迁移 

本文离线辨识 + 零样本迁移的方法对永磁同步电机进行能耗建模，采用四项简洁奖励函数，并通过自底向上的参数建模与验证来实现稳健迁移（从单个执行器到全机器人，再到跨平台）。


- **离线数据采集**：只需约 20 ～60 s 秒悬挂状态下的关节 PD 控制（chirp signal），收集关节轨迹数据。
- **参数辨识**：使用进化算法（CMA-ES）拟合一组关键参数（惯量、摩擦、死区、延迟等）来对齐仿真与真实的自由摆动轨迹。
- **策略训练与迁移**：在辨识后的仿真环境中训练 RL 策略，直接部署到实机即可 **零样本运行**，不需要在真实机器人上进行额外微调或在线学习 。
- **能效建模**：通过永磁同步电机（PMSM）的物理能耗模型 [4]，让奖励函数与真实能耗一致，避免了传统方法中复杂的手工奖励调试 [3]。

---
## 离线数据采集

通过少量、覆盖策略频率的范围的高质量信号激发系统，记录可用于辨识的关节/驱动响应。

- 固定基座：把机器人悬挂/固定避免腿之间的耦合，保证单关节/多关节动力学响应可分离记录。
- 激励信号：对所有关节同时施加 chirp 信号，频率从低到高扫过，仿真训练的频率最好覆盖到策略能激发的最高频率的一半。采用 chrip 信号作为关节输入，频率范围 0.1-10 hz，采样频率为 2.5 khz。


为降低辨识难度，使用较少的关节 PD 增益，使闭环极点落在较低频段，便于在安全激励贷款内捕获动力学特征。


>[! NOTE]
Chirp Signal 是一种连续的正弦信号，其频率会从一个较低值逐渐扫频到较高值，通过扫频覆盖控制器可能用到的运动频率范围，从而捕捉电机与机械结构的动态响应特性，系统性的测量和拟合其动力学特征。

---
## 参数辨识

通过拟合一组紧凑且有物理意义的参数，期望在仿真中得到代表真实系统的环境参数。

***（1）参数辨识的对象***
- 有效惯量
- 粘性阻尼
- 库伦摩擦
- 关节偏置
- 控制/通信延迟

***（2）优化目标：***
将记录的真实目标关节轨迹在仿真速度速率下重放，得到仿真轨迹$q_{sim}$, 并计算其和真实轨迹的$q_{real}$的均方误差。
文章利用 CMA-ES 来 **全局优化动力学参数集合**，即在候选参数空间内迭代搜索。
优化目标：
$$\theta^* = \arg \min_\theta \; \mathcal{L}(\text{sim}(\theta), \text{real})$$
其中 $\theta$ 就是要辨识的参数集（$I_a, d, \tau_f, \text{delay}, \text{bias}$ 等）。

CMA-ES 优化流程

1. **初始化参数分布**
    - 给定均值 $\mu_0$（来自 CAD/厂家数据的初始估计
    - 给定协方差矩阵 $\Sigma_0$（表示搜索范围）
2. **采样候选解**
    - CMA-ES 在每次迭代中，从 $\mathcal{N}(\mu, \Sigma)$ 采样一批参数向量 $\theta_i$
3. **仿真评估**
    - 将 $\theta_i$ 带入仿真，执行与真实机器人相同的实验轨迹
    - 计算损失 $\mathcal{L}_i$
4. **选择与更新分布**
    - 根据损失排序，选择表现最优的候选解
    - 更新均值 $\mu$ 和协方差 $\Sigma$（逐渐收缩到最优区域）
5. **迭代收敛**
    - 多轮迭代后，$\mu$ 就收敛到最佳参数 $\theta^*$。

---
***（3）单驱动辨识 (Single-drive identification)**

在单关节-单连杆的简化模型中，设置连杆惯量为 0，主要用于拟合电枢惯量、粘性阻尼和库伦摩擦。

- 把机器人拆开，只看某个关节驱动（电机+减速器+输出轴）。
- 优化的参数主要是 **电机端动力学参数**：
    - **$I_a$（电枢惯量）**：反映转子、齿轮系等在电机侧看到的等效惯量。
    - **$d$（阻尼/粘性摩擦）**：包括齿轮、轴承摩擦、以及电磁等效阻尼。
    - **$\tau_f$（库伦摩擦力矩）**：静摩擦和干摩擦效应。
    - **$T_d$（延迟）**：信号链路和电控延时。
- 目标是捕捉 **电机–关节的最小动力学单元**。


> 采用 chrip 信号作为关节输入，频率范围 0.1-10 hz，采样频率为 2.5 khz。

**全机器人辨识：**
将机器人基座固定置于空中，以消除地面接触的影响，辨识的参数包括：关节位置偏置、通信延迟以及所有关节动力学参数。

***（4）全机器辨识 (Full-robot identification)***

- 整个机器人在完整结构、惯性耦合和地面接触下运动。
- 优化的参数不仅包含单驱动辨识里的那些，还扩展了：
    - **关节偏置 (joint bias)**：指**零位误差**，即关节编码器的零点和实际几何零点之间的差异。例如理论 0° 时，实际连杆可能已经有 1°–2° 偏差。
    - **关节动力学参数**：指 **在全机器人环境下体现出来的等效动力学特性**，包括：
        - 等效惯量（不光是电机端 $I_a$，还包含连杆 CAD 惯量、补偿效应）
        - 阻尼、摩擦
        - 电机常数、摩擦模型参数
    - 这些参数和单关节在实验台上测出来的值可能不同，因为整机耦合、补偿策略、结构振动会改变表现。


## 策略学习
将参数辨识拟合的动力学参数使仿真与真实对齐进行策略训练，训练过程中只使用四项奖励，并进行动作限制保护；在训练过程中不做动力学随机化，仅随机化任务扰动和地形以增强策略对场景的鲁棒性。

***（1）奖励描述***：
- **速度跟踪**$r_v$：鼓励机器人基体速度接近给定的速度
- **能量消耗** $r_e$：基于对 PMSM 电机的物理能耗进行建模，结合电气耗散与机械功率以及重力势能项进行
- **碰撞惩罚** $r_c$：惩罚关节越界以及腿部与环境碰撞的场景
- **足底接触速度惩罚** $r_{ftd}$ ：在脚着地瞬间，惩罚那段短的历史窗口内脚的最大速度（以避免通过强冲击制动产生磨损/噪声）


***（2）惩罚/熵调度***
- **惩罚调度**：训练初期大惩罚会阻碍策略的探索，因此论文采用指数衰减型$k_{decay}=e^{-\lambda t}$，$k=1-k_{decay}$的奖励函数调度，早期能量消耗会被弱化，策略先学会跟踪，再进行能量/冲击约束。
$$
r = c_v r_v + c_cr_c+k(c_er_e+ c_{ftd}r_{ftd})
$$

- **熵调度**：探索对早期有益但不利于后期的精调，因此采用平滑 Tanh 类的调度将熵系数从初始值$E_0$逐渐退火到$E_{\infty}$

$$
\varepsilon(t) =  \varepsilon_{\infty} + \epsilon (\varepsilon_0-\varepsilon_{\infty})， \epsilon=\frac{1}{2} -\frac{1}{2}\text{tanh}(\eta(t-T_{\varepsilon}))
$$
- $\varepsilon_0$：初始熵系数（鼓励探索）
- $\varepsilon_{\infty}$：最终熵系数（较小，保证收敛）
- $T_{\varepsilon}$：调度的中点，当$t=T_{\varepsilon}$附近，tanh=0，正好位于过渡的中心点
	- $t \gg T_{\varepsilon}$ ,tanh $approx$ 1, 因此$\varepsilon(t) \approx E_{\infty}$
	-  $t \ll T_{\varepsilon}$ ,tanh approx 1, 因此$\varepsilon(t) \approx E_0$
- $\eta$：平滑因子，控制过渡的陡峭程度
