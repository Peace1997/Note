

设计双足六自由度人形机器人的 MPC 运动控制方案，可以借鉴 MIT Cheetah 3 的运动控制思路，但需要针对双足系统的特点进行调整。

***MPC 任务***：
已知当前的系统状态和未来的参考系统状态，求解最优的系统控制输入（地面反作用力，足底接触力）。

***MPC 大致流程***：
1. 对机器人进行动力学微分建模
2. 对微分模型进行约化，使其满足特定形式（凸性）
3. 对微分模型进行离散化，得到预测模型
4. 通过 QP 最优化问题，得到足底接触力

以下是设计该系统的一般步骤：



## 1. 动力学建模

### 单刚体模型（SRBD）
- **质心动力学**：将人形机器人视为一个刚体集中在质心，具备质量$m$和转动惯量$\mathbf{I}$。

- **动力学方程**：
  - 线性动力学：
$$
M \dot{\mathbf{v}} = \mathbf{f}_\text{left} + \mathbf{f}_\text{right} + m \mathbf{g}
$$
  - 角动力学：
$$
    \mathbf{I} \dot{\boldsymbol{\omega}} + \boldsymbol{\omega} \times \mathbf{I} \boldsymbol{\omega} = \mathbf{r}_\text{left} \times \mathbf{f}_\text{left} + \mathbf{r}_\text{right} \times \mathbf{f}_\text{right}
   $$

### 双足力优化
- **摩擦锥约束**：脚与地面接触力满足摩擦锥条件。
- **步态转移**：基于步态周期在双/单腿支撑状态间转换。

## 2. 步态规划

### 步态生成
- **步态模式**：如行走、跑步、站立，确定每只脚的接触状态。
- **步态周期**：定义并调节步态周期，以适应不同地形和速度。

### 支撑状态
- **双腿支撑**：考虑双腿同时接触地面时的稳定性。
- **单腿支撑**：在单腿支撑相位中保持动态平衡。

## 3. 状态预测与约束

### 模型预测控制（MPC）
- **优化目标**：
  - 最小化轨迹偏差，保证质心位置、速度和平衡的期望满足性。
  - 保持动态平衡时，减少脚部的滑动和不稳定性。

- **约束条件**：
  - 地面反作用力需满足摩擦和力矩约束。
  - 支持腿的施力位置约束。
  - 确保足够的步伐边缘稳定性。

## 4. 数值求解

- **QP 求解**：使用快速优化工具（如 QP 求解器）解决 MPC 优化问题。
- **实时性保障**：以高频率（如 1 kHz）更新控制输入，给出实时控制力。

## 5. **输出指导与反馈**

- **关节控制**：将优化得到的足端力转换为关节空间的力矩控制。
- **反馈校正**：利用 IMU 传感器和足压传感器，校正姿态偏差。

## 6. **环境适应**

- **适应性调整**：
  - 针对不同地形（如楼梯、斜坡）带来的挑战，通过步态周期和支撑状态的调整提高适应能力。
  - 结合视觉传感器信息，让机器人预判环境变化。

## 总结

通过将 MIT Cheetah 3 的四足控制策略扩展应用到六自由度双足机器人上，仔细考量双足平衡问题以及步态转换带来的动态稳定性挑战，设计出一套适用于人形机器人的 MPC 运动控制方案。这种方法既保持了 MIT 方案的计算效率，又针对人形机器人的复杂性进行了必要的增强，有助于实现更为灵活和智能的运动控制。