# 单智能体自主探索



### 1.随机指定目标点，躲避障碍物

- **启动Gazebo建图** `$ roslaunch mbot_gazebo mbot_laser_nav_gazebo.launch `

  - 创建地图，创建智能体，设置关节(joint):激光雷达

  - 加载机器人(包含激光雷达)模型描述参数

  - 运行joint_state_publisher节点，发布机器人的关节状态

  - 运行robot_state_publisher节点，发布tf

  - 运行 gazebo_ros节点，在gazebo中加载机器人模型

  - 涉及节点描述：

    > - [joint_state_publisher](http://wiki.ros.org/action/fullsearch/joint_state_publisher?action=fullsearch&context=180&value=linkto%3A"joint_state_publisher")：该功能包包含一个工具，用于为给定的URDF设置和发布一个联合状态值（joint state）
    >
    > - [robot_state_publisher](http://wiki.ros.org/action/fullsearch/robot_state_publisher?action=fullsearch&context=180&value=linkto%3A"robot_state_publisher")：该功能包可以将机器人的状态发布到tf
    >
    >   > ROS坐标管理系统：TF，用于坐标变化，计算各个坐标系之间的关系。例如移动机器人的本体坐标系与雷达坐标系的转换
    >
    > - [gazebo_ros](http://wiki.ros.org/action/fullsearch/gazebo_ros?action=fullsearch&context=180&value=linkto%3A"gazebo_ros")：通过ROS为Gazebo接口提供消息(message)和服务发布者(service publishers)

- **启动move_base和rviz构图** `$ roslaunch mbot_navigation exploring_slam_demo.launch`

  - 运行gmapping节点

  - 运行move_base节点

  - 运行rviz节点

    > -  [gmapping](http://wiki.ros.org/action/fullsearch/gmapping?action=fullsearch&context=180&value=linkto%3A"gmapping")：基于2D激光雷达使用RBPF（Rao-Blackwellized Particle Filters）算法完成二维栅格地图构建的SLAM算法
    > - [move_base](http://wiki.ros.org/action/fullsearch/move_base?action=fullsearch&context=180&value=linkto%3A"move_base")：是ROS下关于机器人路径规划的中心枢纽。 它通过订阅激光雷达、map地图、amcl的定位等数据，然后规划出全局和局部路径，再将路径转化为机器人的速度信息，最终实现机器人导航。   可以让机器人移动至我们指定的目标地点，其中包含避障，路径规划等功能。
    > - [rviz](http://wiki.ros.org/action/fullsearch/rviz?action=fullsearch&context=180&value=linkto%3A"rviz")： rviz是ROS自带的图形化工具，可以很方便的让用户通过图形界面开发调试ROS

- **随机给定目标点，机器人开始移动**： `$ rosrun mbot_navigation exploring_random.py`

  - 初始化“随机探索”节点：

  - 定义发布话题(topic)： `cmd_vel`，类型为 `Twist`

    > Twist(线速度角速度)通常被用于发送到/cmd_vel话题，被base controller节点监听，控制机器人运动

  - 创建`move_base` 客户端，订阅`move_base`服务器端的消息，消息类型为`MoveBaseAction`

  - 记录初始位置

  - 开始主循环，随机导航

    - 记录到目标点的行驶距离
    - 设定下一个目标点：`MoveBaseGoal`
    - 在限定时间内向下一个目标位置进发：`MoveBaseAction`  —— Dijkstra算法
    - 判断是否成功到达，并打印相关信息



<video src="/Users/mapeixin/Documents/Typora/ROS/img/run0_1.mov"></video>

随机给定一个目标点，此时会通过move_base给定一个全局路径规划（绿色的线），作为机器人接下来运动的指导路径，机器人会边运动边建图（gmapping）。如果在运动过程中，突然加入一个障碍物，激光雷达监测到该障碍物后会重新规划全局路径，从而避开障碍物，到达指定的目标点。



- 涉及package

```
ros-melodic-joy ros-melodic-teleop-twist-joy ros-melodic-teleop-twist-keyboard ros-melodic-laser-proc ros-melodic-rgbd-launch ros-melodic-depthimage-to-laserscan ros-melodic-rosserial-arduino ros-melodic-rosserial-python ros-melodic-rosserial-server ros-melodic-rosserial-client ros-melodic-rosserial-msgs ros-melodic-amcl ros-melodic-map-server ros-melodic-move-base ros-melodic-urdf ros-melodic-xacro ros-melodic-compressed-image-transport ros-melodic-rqt-image-view ros-melodic-gmapping ros-melodic-navigation ros-melodic-interactive-markers


$ cd ~/catkin_ws/src/
$ git clone https://github.com/ROBOTIS-GIT/turtlebot3_msgs.git
$ git clone https://github.com/ROBOTIS-GIT/turtlebot3.git
$ cd ~/catkin_ws && catkin_make
```