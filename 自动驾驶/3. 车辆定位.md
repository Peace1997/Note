# 一、 概述

### 任务

利用车辆的硬件测量结果（IMU、LiDAR、IMU），结合地图软件输入比对得到车辆位置的过程。

### 传感器
定位精度需要达到厘米级才能保证驾驶的安全和高效，单一的导航无法实现这样的定位精度。


- **GNSS**：能在地球表面或近地空间的任何地点为用户提供全天侯的三维坐标和速度以及时间信息的空基无线电导航定位系统，例如GPS、BDS（北斗），GPS 确定无人车在地球上具体位置，结合载波相位差分技术（Real Time Kinematic，RTK）可以达到厘米级精度（**差分GPS技术**）。

- **IMU**：测量物体三轴姿态角（角速率）以及加速度的装置。

> 陀螺仪和加速度计作为主要元件，其精度直接影响惯性系统的精度，由于误差累积的缺点，需要利用外部信息进行辅助，实现组合导航，使其有效的减少随时间积累的问题。




# 二、高精地图

## 简述
高精地图和普通地图最大的的区别在于高精地图可以达到**厘米级**的精度。并且具有数据**实时性**强、**数据维数**多等特点。

高精地图包含大量的**驾驶辅助信息**和**环境的语义信息**。
- 驾驶辅助信息：最主要的是对路网精确的三维表征，通过对比车载传感器来精确地**确认当前地位置**。
- 环境语义信息：交叉路口的布局、交通标志牌等，可以提高车辆鉴别周围环境的能力。

## 应用

高精地图可以应用在**定位、感知、规划、决策**过程中。利用高精地图可以节省很多传感器的成本，但是目前自动驾驶的主流还是模仿人的驾驶行为，高精地图的解决方案主要由地图提供商和自动驾驶独角兽企业提供，因为高精地图无法替代自动驾驶的核心组件。

***定位***

利用车载传感器收集到的 Landmarks 信息与高精地图里预存的 Landmarks 进行**匹配**就能得到车辆自身的精确位置。利用高精地图提供的标准的位置，通过横向定位和纵向定位可以实现低成本的设计方案。
- **横向定位**：利用单目相机拍摄虚线和实线，把采集的图像和高精地图进行对比，通过算法可以知道当前在道路的第几个车道。
- **纵向定位**：借助交通信号灯、路灯、灯杆等实现定位。

***感知***

- **增加系统冗余度，节省传感器成本**：由于每种传感器受测量距离、天气或光照条件的限制，在较远区域、因障碍物被遮挡的区域，高精地图都可以为传感器融合提供一个新的数据源。
- **提高探测精度和速度，节省计算资源** ： 通过ROI（感兴趣区域）缩小传感器的探测范围。

***规划***

- **运动预测** ：高精地图与车辆的历史运动数据相结合，更好地为车辆规划合适的行驶区域。
- **异常处理** ：如果车在路上发现前面有事故或施工路面，利用高精地图提供的环境信息实现变道。

***决策***

**安全决策**： 车在十字路口，高精地图会采集安全岛的信息，避免车辆与安全岛发生碰撞。


# 三、 定位模式

## RTK
载波相位差分技术，在定位过程中结合 GPS 和 IMU 的输入进行综合的考虑。

实时处理两个测量站载波相位观测量的差分方法，将基准站采集的载波相位发给用户接收机，进行求差解坐标。RTK能够在野外实时得到厘米级的定位精度。

>载波相位测量：利用卫星与接收器之间相对运动的关系，先取得卫星发射讯号时所产生的相位与接收器接收时所产生的参考相位，并求出两者之间的相位差值，即为载波观测量

### GPS

GPS 定位的原理是：测量地面 GPS 接收器到已知位置的卫星的距离，然后接收器通过与至少 4 颗卫星通信，计算与这些卫星间的距离，就能确定其在地球上的**具体位置**。

### IMU
IMU：提供的是一个**相对**的定位信息，它的作用是测量相对于**起点**物体所运动的路线，所以它并不能提供所在的具体位置的信息。

**原理**：利用汽车的初始速度、加速度和初始位置计算汽车的位置和速度装置。
**核心**：三轴加速度计（加速度）和陀螺仪（角速度）
**弊端与解决**：IMU 更新频率很快，但其运动误差随时间而线性增加，所以只能用于短时间测量。结合 GPS 和 IMU 可以解决 GPS 更新频率低的问题。



## MSF
多传感器融合定位

多种传感器可以采集不同形式的数据，用于生成不同类型的和不同权重的参数，从而可以避免单一定位方法的缺陷，获得更加准确的定位结果。

传感器数据融合算法：
- 贝叶斯统计理论：[[4. 朴素贝叶斯]]  [[贝叶斯优化]]
- 卡尔曼滤波方法 [[图优化]]
- 神经网络技术

## AMCL
基于蒙特卡洛定位算法，集成于ROS操作系统的navigation导航包，用于获取机器人在世界坐标系下相对准确的坐标。

*为什么需要 AMCL？*

里程计odom会有累积误差，随着机器人不断运动，这这个误差会不断进行叠加。
陀螺仪是基于积分型的，也会有误差。

![500](img/amcl2.png)

*AMCL 获得了机器人坐标后，如何传给用于导航的 move_base ？*

AMCL 获取机器人坐标后，发布一个关于 odom---map 的两个坐标系的 TF 坐标变换。

>odom 指里程计的坐标系，这个坐标系在小车启动底盘的时候建立（即以小车的起点为原点）
>map指的是全局坐标系---global map。global map同样是在机器人启动的时候建立的，开始时map坐标系的方向跟odom一致，但随着机器人不断运动，由于里程计的误差，会使得odom和map坐标系的原点不重合。那这时如何修正呢？发布一个odom----map的TF坐标变换即可。