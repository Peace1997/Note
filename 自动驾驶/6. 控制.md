
## 一、 概述

在环境感知的基础之上，根据路径规划模块决策规划出的目标轨迹，通过对转向、驱动、制动等方面地控制，执行规划决策模块**下发的**期望速度和期望转向角度，使汽车能够按照目标轨迹准确稳定行驶。


***核心问题和关键技术***

核心问题：如何快速响应并执行上层规划的指令，从控制架构的层面来看，汽车智能驾驶是在**整车**层面上进行控制。

关键技术：车辆协同控制及行驶优化技术、多目标优化理论及方法、车辆自主运动决策、横纵向跟踪控制技术、车辆紧急避障技术等。


***如果无人车不按既定路线走如何处理？***

**反馈控制**：将当前位置和参考线比较，得到当前偏离参考线的距离（误差），基于这个误差，设计一定的算法来产生输出信号，使得这个误差不断变小。

### PID 控制

PID 就是指比例（Proportion）、积分（Integral）、导数（Derivative）

**基本流程：**
- 首先根据反馈和参考值求出误差，具体的误差可以是速度差值、位置差值。
- 求出误差以后，在根据误差求比例、积分和微分三项，其中 $K_p$、$K_i$、$K_d$ 是 3 项的系数，它们决定着 3 项对最后输出的影响的比重。将 P、I、D 三项求和作为最好的输出信号。
$$
u\left( n \right) =\left(k_p err\left( n \right) +k_i\sum_{j=1}^n{err\left( j \right) +k_d\left( err\left( n \right) -err\left( n-1 \right) \right)} \right)
$$

### MPC 控制
[[MPC]]

MPC 的基本工作原理如下：

1. 首先，建立系统的动态模型，定义控制目标和约束。
3. 接下来，根据当前系统状态，预测未来一段时间内系统的状态和输出，
4. 最后，通过优化计算控制输入（将得到的最优控制序列的第一个元素作用于被控对象），以使预测的输出尽可能接近目标，同时满足约束条件。

作用机理：每一采样时刻，根据获得的当前测量信息在线求解一个有限时间开环优化问题，并将得到的控制序列的第一个元素作用于被控对象。在下一个采样时刻重复上述过程：用新的测量值作为此时预测系统未来动态的初始条件，刷新优化问题并重新求解。




## 基本概念
*利用一个已有的模型、系统当前状态和未来的控制量，来预测系统未来的输出，然后与我们期望的系统输出做比较，得到一个损失函数：*
$$
损失函数= (未来输出 (模型，未来控制量，当前状态) - 期望输出) ^2 
$$
模型、当前状态、期望输出都是已知的，因此只有未来控制量一个自变量。采用二次规划的方法求解出某个未来控制量，使得损失函数最小，这个未来控制量的第一个元素就是当前控制周期的控制量。
 

**预测模型**：对未来一段时间内的输出进行预测；
- *预测时域*：预测未来多少个时间步长，表示控制器对未来状态的预测程度。
- *控制时域*：求解出多少组控制量（控制时域一般选为预测时域的10%到20%。）

**滚动优化**：滚动进行有限时域在线优化 (最优控制)；
> 最优控制：建立描述受控运动过程的运动方程，给出控制变量的允许取值范围，指定运动过程的初始状态和目标状态，并且规定一个评价运动过程品质优劣的性能指标，建立最优化问题的数学模型，在此基础上求出最优解。

**反馈校正**：通过预测误差反馈，修正预测模型，提高预测精度。





## MPC 在四足机器人中的应用
将四足机器人简化为单刚体后构建一个多点支撑的力平衡模型，通过 MPC 控制理论在线性假设下使用 QP 优化来求解。


## MPC 与 PID
**PID控制器**
$$
u\left( n \right) =k_p\left( err\left( n \right) +k_i\sum_{j=1}^n{err\left( j \right) +k_d\left( err\left( n \right) -err\left( n-1 \right) \right)} \right)
$$
不具前瞻性（仅有当前误差和历史误差，没有未来误差）、无模型控制（近根据目标状态和当前状态进行控制）
**MPC**
通过“控制时域”和“预测时域”