**总体：**
**摘要**：一段话的介绍整个流程


其他还需要采集什么数据


**总体概述**
该研究团队利用腿部力学体现的智能去学习一个步行系统，设计了一个约半米高具有被动弹性的机器人 Morti，基于短期弹性和长期塑性的概念，提出了一个匹配控制模式和自然动力学的框架，Morti可以自主的从失败中进行学习，最终能够在一小时内学会以 0.3m/s 的速度进行快步走，利用该机制的优势，Morti 将其能源效率提高了 42%。


## 概述 
控制 Morti 的人工智能算法没有包含过多的机器人腿部信息，如每个部件的确切状态，而是模拟了一些动物脊髓中的神经网络。这些网络使肌肉有节奏地收缩以帮助动物行走。人工智能为Morti生成行走指令，然后根据机器人摔倒后与地面失去接触时脚部传感器发出的信号进行调整。最初，Morti在走路时频频摔倒，但约1个小时后，人工智能就为Morti找到了最佳行走方式。
人工智能如果通过提前计算机器人每条腿的运动细节，指导其行走，会消耗大量能量，而Morti自我学习的行走方式可以降低能量消耗。1个小时的学习过程结束时，Morti走路消耗的能量比刚开始学习时减少了42%。



本文研究了在有限的神经控制、有限传感器带宽、稀疏反馈的情况下，通过中枢模式发生器（CPG）完成对四足机器人的运动控制，在这里重点关注了被动机械结构和控制器的协同作用，并按时间范围划分反馈活动，在短期内通过弹性反馈实现了扰动缓解，同时量化了控制模式和自然动力学的不匹配，通过贝叶斯优化器可塑性的将控制模式与自然动力学相匹配，优化了系统的长期性能，使控制器塑性适应其机械系统。


**技术概括**：
通过改进Hopf非线形振荡器构建CPG模型，通过CPG可以输出各个关节的运动轨迹，PID控制器将参考该运动轨迹计算关节电机电流。
在这里重点关注了被动机械结构和控制器的协同作用，并按时间范围划分反馈活动，在短期内通过弹性反馈实现了扰动缓解，同时量化了控制模式和自然动力学的不匹配，通过贝叶斯优化器可塑性的将控制模式与自然动力学相匹配，优化了系统的长期性能，使控制器塑性适应其机械系统。


> 将能源效率和速度作为评估机器人系统的标准。

**效果**：完成了怎样的任务
- 在不需要高带宽和高控制频率的硬件上，能够在一小时内使 Morti 以 0.3m/s 的速度进行快步走。
**优点**：它的优点体现在哪里
- 目前没有用于被动弹性机器中控制模式的长期匹配和复杂行走系统的自然动力学（创新点）
- 将
- 能够在一小时内使 Morti 以 0.3m/s 的速度学习小跑步态。
- 提升了能源效率。通过增加自然动力学与运动的模式的匹配程度，可以有效的提升能源效率。
- 
- 无模型的运动控制，能够在相对较为低廉的硬件上行走
> 4000欧元以下的硬件：5W Raspberry 用作计算、500Hz的控制回路、250Hz二进制传感器信号；因为作者采用的是无模型控制，相对于当前最先进的有模型的运动控制需要高带宽计算（>17w）和高控制频率（>2kHz）。

- 可以直接应用到硬件中，不需要额外的修改
> 在 sim2real过程中，如果我们直接学习影响关节力矩和腿部力的的控制器，模型和硬件之间较小的不准确都有可能会影响最后的结果，会造成仿真和实际中较大的差距，
> 因为Morti的关节力矩不是从潜在的不准确的模型参数重计算出来的（**那是怎么计算出来的？？？？？**），因此在sim2real的过程中差距不会很大。如果

- 与特定于任务的成本函数（速度、能源效率），本文提供了一种内在动力的方法，尽可能利用自然动力学中的具体智能。

**缺点**：
- 当前没有考虑身体的俯仰；日后在生成臀部轨迹时加入俯仰
- 在当前的公式中，没有考虑身体的间隙，而是依赖于被动弹性增加到系统中的鲁棒性来补偿现有的身体间隙。
- 没有考虑外展/内收自由度及其各自的反馈回路；日后可以将其加入到Morti中，以在没有引导机制的情况下实现3D运动。
- 没有在复杂环境下完成步行
**对比**：与强化学习相比是怎么样的
**应用场景是什么**：
作者提出的无模型匹配的方法可以扩展到不同的柔顺机器人上，也可以适用于更通用的控制方法，例如基于模型的全身控制，或者更具通用行为的CPG中。
**是否能移植到我们的机器人上**
**可行性方案又是什么**：
因为通过贝叶斯优化CPG模型，因为是平坦环境下，当前优化的参数是相对较少，如果应用在更加复杂的环境中时，可能得需要更多的参数进行优化。因此我们可以利用本文的短期弹性反馈和长期塑性优化优化我们强化学习的方案，

我们可以利用CPG设定的短期弹性反馈。预先设定好几种扰动的处理方式，对特定的扰动直接进行纠正，这样可以加快前期的学习效率。

对于长期塑性优化，我们现在设定的奖励函数，通常是特定于任务的奖励函数，这类奖励通常是外在的奖励，如果想让智能体学习的更快更好，可以提供一些内在奖励（利用自身的特性），就是这里如果我们运动控制器匹配自然动力学。不限于使用贝叶斯优化方法对成本函数进行优化，也可以采用强化学习的方法，把这里的成本函数作为奖励函数的一部分，在这里是最小化成本函数，在强化学习中目标是最大化回报，所以将成本函数的值取反后，作为奖励函数的组成部分。

因为贝叶斯优化通常只适用于较少的超参数，我们可以利用贝叶斯优化来调整强化学习的超参数，例如学习率、Batch Size ， gamma 等等，通过贝叶斯优化的方法确定好我们能达到最好效果的超参数值。

**具体的原理**：
- 整体的流程是怎么样来的
- CPG 是什么；他完成了什么样的任务
- 贝叶斯优化方法是什么
- 短期弹性和长期塑性的具体实现方案是什么
- 他为什么可以在 1 小时就可以完成学习；怎样进行学习的

- sim2real的实现方式

**源码模型试验数据：**


>本报讯 一个四条腿的机器人只用1小时就学会了走路，这与新生小马驹学会走路所需的时间大致相同。
德国马克斯·普朗克智能系统研究所的Felix Ruppert和Alexander Badri-Sprowitz设计了一款半米高的机器人——Morti。它能够自学如何行走，而非执行预先编好的步态程序。相关研究7月18日发表于《自然—机器智能》。
控制Morti的人工智能算法没有包含过多的机器人腿部信息，如每个部件的确切状态，而是模拟了一些动物脊髓中的神经网络。这些网络使肌肉有节奏地收缩以帮助动物行走。
人工智能为Morti生成行走指令，然后根据机器人摔倒后与地面失去接触时脚部传感器发出的信号进行调整。最初，Morti在走路时频频摔倒，但约1个小时后，人工智能就为Morti找到了最佳行走方式。
人工智能如果通过提前计算机器人每条腿的运动细节，指导其行走，会消耗大量能量，而Morti自我学习的行走方式可以降低能量消耗。1个小时的学习过程结束时，Morti走路消耗的能量比刚开始学习时减少了42%。
Morti模仿了动物幼崽学“走路”的方式。这些幼崽通过不断尝试和摔倒，找到使用肌肉的最有效方式。
“只要学会正确使用双腿，基本上就可以‘免费’获得能效。”Ruppert说。
美国得克萨斯大学圣安东尼奥分校的Dhiresha Kudithipudi表示，人工智能通常可以很好地学习一个特定任务，但无法在环境变化时重新校准。而Morti的人工智能系统能够不断调整机器人的运动方式，这可能使其在环境变化时表现得更好。
凯斯西储大学的Hillel Chiel指出，动物大脑包含有助于学习的结构和知识，目前一些人工智能可以模仿动物的学习方式，但人工智能构建的神经系统通常不会太复杂。
Ruppert说，他和团队正在努力为Morti添加更多传感器，扩大运动范围，使其成为更像动物的机器人。（徐锐）
‘

研究团队：德国斯图加特的马克斯普朗克智能系统研究所（MPI-IS）

参考论文：

Ruppert, F., Badri-Spröwitz, A. Learning plastic matching of robot dynamics in closed-loop central pattern generators. Nat Mach Intell 4, 652–660 (2022). https://doi.org/10.1038/s42256-022-00505-4

该研究团队制造了一个有四条腿的机器狗 Morti，参考动物腿部力学中的弹性和可塑性，通过无模型贝叶斯优化算法指导它学习，最终四足机器人可以很快的从失败中学习如何走路。
> 模仿动物腿部力学的智能方式：弹性+可塑性；在通过中枢模式发生器控制机器人运动时，与自然动力学进行匹配，顺行性的调整运动模式，降低能源效率。为了更好的将控制模式与自然动力学匹配，按时间范围分离反馈，对于一些低强度的刺激，利用脚上接触传感器的稀疏反馈，通过短期弹性反馈进行纠正（CPG控制），然后返回到其初始状态一样；对于长期性刺激，使用弹性反馈活动数量为作为自然动力学与控制模式的之间不匹配的代理，通过无模型的贝叶斯优化塑性的最小化了所需要的弹性反馈活动，进而优化控制模式中CPG参数，优化生成控制模式的 CPG 参数。塑性地将 CPG 的控制模式与 Morti 的自然动力学相匹配

## 研究背景
动物的脊髓中存在一个叫做中枢模式发生器（central pattern generator (CPG)）的神经元网络，它可以从非周期性的输入中产生具有周期性的输出，从而完成一些有节奏的任务，例如咀嚼、呼吸和腿部运动等任务。 运动控制反射帮助它们在第一次尝试行走时避免摔倒和受伤。动物利用其肌肉和肌腱的顺应性（compliance）来实现灵活运动性能，同时减少控制工作工作和能源效率，不过在动物刚出生阶段，他们的 CPG 还没有调整好，它们在平坦或不平的地形上都会表现的磕磕绊绊，但是它们很快就能学会通过 CPG 和反射去更加精准的控制腿部的肌肉和肌腱。

作者从神经科学的神经弹性和长期神经可塑性以及力学中弹性和可塑性中获取灵感，该概念描述了其强度对于环境刺激的反应。为了更好的将控制模式与自然动力学匹配，作者将系统扰动按时间范围分开，减轻具有低强度的一次性刺激，并且控制模式弹性返回其初始状态，对于永久或频繁刺激的将会塑性的调整控制模式，以消除所需控制模式和自然动力学行为之间的差异。

顺应机制（Compliant mechanisms）是自然动力学的重要组成部分，正是因为腿部的顺应机制，动物可以在存在神经延迟和有限的执行器功率和带宽的情况下，安全地穿越崎岖和非结构化的地形。顺应机制可以有助于减轻步行系统与环境之间的相互作用力，不过这些相互作用力难以建模并且具有高度不确定性。

仿生机器人将它们产生的控制模式（所需的肌肉或运动激活模式）和自然动力学相匹配，可以更好的利用其被动特性，而如果控制模式和自然动力学不匹配，那么控制器则需要额外的能量来执行所需的行为，即克服被动机械元件产生的力和扭矩。在本文中，作者专注于量化控制模式和自然动力学的匹配，以及如何在仿生四足机器人中改进和学习匹配。



由于动物的脊髓是比较复杂的，目前我们尚不清楚生物运动控制器是如何学会利用其腿部力学体现的智能的，因此该研究团队设计了一个具有被动弹性腿的四足机器人 Morti，更好的去了解动物如何从磕磕绊绊中学会行走的。


## 概述

Morti 的虚拟脊髓放置在 Morti 的头部位置，Morti 在行走的过程中，足底传感数据不断与它自身 CPG 预测的预期触地进行比较，Morti 的虚拟脊髓并不了解自身的腿部设计、动力来源和身体结构。

## 基本框架
基于短期弹性（short-term elasticity）和长期可塑性（long-term plasticity）的概念，作者提出了一个匹配控制模式和自然动力学的框架。设计了一个具有被动弹性腿的四足机器人 Morti，该机器人由仿生闭环中枢模式发生器控制（bioinspired closed-loop cpg），该发生器利用其脚上接触传感器的稀疏反馈，弹性的减少短期扰动；对于长期可塑性，使用反馈活动为作为Morti自然动力学与控制模式的之间不匹配的代理，通过无模型的贝叶斯优化塑性的最小化了所需要的弹性反馈活动。

**对于短期弹性反馈，是预先设定好的，只有在特定的情况下才执行， 而长期塑性匹配，可以通过贝叶斯定理优化CPG参数，调整后的CPG参数会改变Morti的运动模式，即影响Morti利用腿部动力学的能力。**


通过最小化所需的弹性反馈活动，运动控制器（**CPG？**）学会增加其控制模式与自然动力学之间的匹配，进而使运动控制器能够利用被动顺应（柔顺）的腿结构间接提高能源效率。



### 机器人结构
机器人力学：Morti 四足机器人由四个安装在碳纤维主体上的 “ 双关节腿（biarticular legs）”组成，每条腿有三个部分：股骨、小腿和脚组成。股骨和足节之间通过弹簧加载的平行机制连接，该机制模仿了四足动物腓肠肌 肌腱组形成的双关节肌腱结构。受动物髌腱（帮助肌肉控制小腿）启发，膝弹簧提供了膝关节的被动弹性。
机器人配备了关节角度传感器、位置传感器和跑步机速度传感器，为了测量与地面的接触，在Morti的脚上安装了脚底接触传感器，通过提前设定的阈值，压力传感器用于确定它是否与地面进行接触。

在髋部和足部之间存在一个膝关节弹簧和一个双关节弹簧，用于提供系列弹性行为。通过类似反射的反馈机制，Morti可以弹性的减轻短期扰动。
![600](综合/四足机器人/调研/img/Paper8_1.png)


### 控制结构
在计算膝关节电流时，需要额外计算一个反馈项，它需要根据膝关节角度计算压缩膝关节弹簧所需的静态电流。被动膝关节弹簧根据膝关节角度为膝关节提供被动阻抗。

### CPG
动物最常见的运动方式是节律运动，即按照一定的节奏、有力度地重复、协调、持续进行的动作，是低级神经中枢的自激行为。生物学上，动物的节律运动控制区被认为是分层并且模块化的，其控制以中枢模式发生器为中心，既可以接受来自高层的高级神经中枢的主观控制，也可以响应来自躯体各种感受器官的反射，这就是 CPG 控制机理。

在这里使用的 CPG 是改进的的 Hopf 振荡器，它在相位空间中建模。现在存在更具生物学准确性和仿生性的 CPG 模型，之所以选择这种 CPG 模型，是因为它减少了参数空间，同时保留了生成关节运动轨迹所需的功能。

CPG 网络采用全对称连接的网络拓扑结构，由四个相互耦合的振荡器组成，每个节点表示其中一条腿的步态相位，通过节点之间的相位差，可以表现出不同的步态。Morti 是按照 左前腿—右后腿—右前腿—左后腿的抬腿顺序循环运动。对于每个振荡器的计算公式如下：
![600](综合/四足机器人/调研/img/Paper8_5.png)
$$
\dot{\phi}_{j}=2 \pi f+\sum_{k=1}^{N} \alpha_{\mathrm{dyn}, j, k} \cdot \mathbf{C}_{j k} \cdot \sin \left(\phi_{k}-\phi_{j}-\boldsymbol{\Phi}_{j k}\right)
$$
CPG 的输入主要包括外部感知信息（通过接触传感器数据计算占空因素）、耦合信息（耦合矩阵、不同步态所需要的相位差）。
![](综合/四足机器人/调研/img/Paper8_4.png)

CPG 生成的关节轨迹主要由下面以下参数描述：
- 髋部偏移$\Theta_{\text {hipOffset }}$、髋部幅度$\Theta_{\text {hipAmplitude }}$：描述髋部轨迹
- 膝关节偏移 $\Theta_{\text {kneeOffset }}$、膝关节幅度 $\Theta_{\text {kneeAmplitude }}$ ：描述膝关节轨迹
- 膝关节相位偏移$\delta_{\phi, \text { knee }}$：描述了髋关节前伸和膝关节屈曲之间的相位差
- 膝关节过度摆动$\delta_{\text {overswing }}$：描述摆动腿的回缩量
- 频率 $f$ ：确定机器人的整体速度
- 占空因素（duty factors）$D$：由于$D_{front}$、$D_{hind}$组成；描述站立相位时间在总时间（站立相位+腾空相位）中所占比例（4dim）；通过占空因素的大小可以判断现在是处于静态步态还是动态步态。

根据CPG的生成的轨迹，我认为CPG主要控制每条腿中髋关节的前伸//屈曲、膝关节的前伸//屈曲，并没有控制髋关节的外展//内收。


利用 CPG 模型实现步态转换的本质是调节 CPG 网络中各振荡器之间的相位关系。

在相位空间建模的修改后的 Hopf 振荡器。
> CPG模型分类
目前比较经典的CPG模型可划分为以下两大类：
①基于神经元的模型：Matsuoka神经元震荡模型、Kimura模型等，该类模型生物学意义明确，但参数较多，动态特性分析比较复杂。
②基于非线性振荡器的模型：Kuramoto相位振荡器、Hopf谐波振荡器等，该类模型参数较少，模型比较成熟。

在保证能够输出稳定的周期性震荡信号的前提下，那些形式简单、参数较少、计算量小、便于分析、易于实现的 CPG 模型是更好的选择。根据这一个原则，我们选取了 HOPF 振荡器作为 CPG 控制的核心。

CPG网络是底层控制结构，是预先定义的，不需要在学习方法中进行近似。本文中选用了一个简化的CPG来限制底层模型的复杂性，这样做虽然会限制我们部分技术实现，但是通过最小化弹性反馈以增加控制模式和自然动力学之间的匹配方法不会受到所选CPG模型的限制，并且可以迁移到具有**所需弹性反馈量？** 的其他运动控制器上。

### 弹性反馈（Elastic feedback）
通过接触传感器的稀疏二进制反馈，控制器能够弹性的减轻由于初始不匹配引起的扰动。

**为什么会产生不匹配的情况？**
由于自然动力学和机械限制（惯性、电机速度、扭矩限制），CPG 无法控制机器人完成相应的行为。这个缺点可以通过反馈来缓解期望行为和实际行为（限制后的行为）之间的差距。

**怎么来缓解这样的差距？**
该接触信息可以集成到 CPG 中，利用该接触信息用来计算CPG 预期轨迹的差距，通过相位振荡器的加速或减速去纠正Morti的行为，对下面可能出现的四种情况，进行预先定义，只有在特定情况下才可以触发，类似于实现动物的反射功能。

**四种异常情况处理：**
- 过早触地 $r_{ETD}$ ：如果腿在摆动阶段，腿可能过早触地，导致机器人绊倒，这种扰动来自于腿向前摆动的同时伸展了膝盖，因此通过一个反馈回路来减少这种影响，在摆动阶段，如果脚过早的触地，将膝盖额外弯曲 5°，创造更多的离地间隙，同时停止腿的向前摆动，在发生撞击时，增加膝关节屈曲度，同时禁用髋关节马达（足部撞击引入的撞击能量将存储在膝关节和双关节弹簧中，不会破坏机器人的稳定性）
- 过早离地 $r_{ETO}$ ：如果腿在站立阶段过早失去与地面的失去接触，我们就希望膝盖更早开始弯曲以防止进一步接触地面；具体为早期脚离地时重新配置膝盖轨迹提供足够的离地间隙以在腾空阶段将腿向后摆动到相应的转折点并向前摆动。
- 延迟触地 $r_{LTD}$ ：此时腿已经向后移动但尚未建立地面接触，可以使振荡器节点减速，直至建立于地面的接触。
- 延迟离地 $r_{LTO}$ ：在站立结束阶段，腿在开始摆动阶段之前等待与地面结束接触，由于机器人的双站姿阶段阻止了腿完全脱离地面，因此阻止了反馈驱动的膝关节屈曲，因此延迟脚趾离地机制没有用于相位减速。


- 通过改变 CPG 的动力学（加速或减速 CPG 的相位），进而通过反馈影响 CPG 创建的轨迹。或者反馈可以影响生成的关节角度轨迹。如果 Morti 在建立或失去地面接触的时间早于或晚于 CPG 的指示时，反馈机制就会对触地（touchdown）和 toeoff（脚离地）中的时间差异做出反应，纠正 CPG 的轨迹。具体为：如果触地和离地的时间早于或晚于反馈控制模型（CPG）的指令，就通过加速或减速每条腿（CPG 节点）的各个相位去纠正 Morti 的行为。

> 例如当触地被延迟时，我们就实行相位减速（红色部分）；当脚过早失去与地面的接触时，我们就加速膝关节屈伸（橙色部分）；当脚离地晚于命令时，进行相位减速（哪个相位？？？？是不是减速膝关节屈伸）（绿色）将这些反馈机制与膝上拉相结合，但是如果腿过早触地时无法完成相应的髌骨反射。如果在摆动阶段，一条腿撞到地面（紫色），膝盖会按照预定的轨迹弯曲产生更多的离地间隙？？？。
> 禁用了髋关节马达，使其不会干扰机械腿弹簧的被动冲击缓解。
> ![300](综合/四足机器人/调研/img/Paper8_3.png)

**主动反馈是什么**？？？图 4



>弹性活动是可逆的，只有在扰动存在时才会活跃，就像弹簧只有在外力活跃时才会偏转，然后返回到其初始状态一样。可塑性永久地改变系统行为，以适应来自环境的长期主动刺激。如果经常出现相同的扰动，系统就会适应该扰动。弹性反馈活动通过来自脚底接触传感器的稀疏接触反馈来缓解短期扰动。为了量化控制模式与 Morti 自然动力学的匹配程度，我们使用弹性反馈活动（elastic feedback activity）作为代理，如果动态不匹配，则反馈机制必须不断进行干扰，来纠正 Morti 命令和行为之间的差异，控制模式的匹配需要可塑性的增加。为了提高塑性匹配，作者利用贝叶斯优化的方法，通过最小化弹性反馈活动的数量来优化生成控制模式的 CPG 参数，塑性地将 CPG 的控制模式与 Morti 的自然动力学相匹配。

>

> 
在Morti尚未形成良好的动态匹配之前，这样的反馈机制可以减轻由动态不匹配引起的扰动，这种的缓解效果在优化的开始会格外重要（为什么格外重要？）

### 塑性适应（Plastic adaptation）
控制模式的匹配需要可塑性的增加。为了提高塑性匹配，作者利用贝叶斯优化的方法，通过最小化设计的成本来优化生成控制模式的 CPG 参数（CPG 生成的关节轨迹的参数），塑性地将 CPG 的控制模式与 Morti 的自然动力学相匹配。

**怎样提高匹配度的？**
通过调整CPG的参数来提升控制器与自然动力学（被动顺应腿结构），CPG参数可通过贝叶斯优化的方法来改进，贝叶斯方法期望通过最小化成本函数，学习到最优的CPG参数。成本函数中比较重要的一项就是触发四种弹性反馈的数量，降低这些扰动的发生，就说明CPG与自然动力学更匹配，CPG之前预测的运动轨迹与实际根据脚步稀疏反馈信息预测的运动轨迹更加匹配，不需要根据叫脚步稀疏反馈信息进行调整运动轨迹。


通过反馈活动（**是不是上面的短期弹性反馈？**）作为自然动力学和控制模式之间不匹配的代理。通过无模型贝叶斯优化，塑性（**什么叫做塑性，是不是类似于缓慢的增加这种匹配度**）的最小化所需的反馈活动

Morti设计的被动行为（**被动行为是什么？**）使简单匹配的CPG控制（**匹配CPG是什么？**）结构能够有效利用腿部设计的自然动力学（**什么是腿部的自然动力学**）


为了使得 CPG 于机器人的动力学相匹配，通过调整 CPG 参数 $p_m$ 以实现最佳的性能，通过多个步骤评估了 Morti 的性能。其中优化的时间尺度远大于弹性反馈活动机制的频率，因此，弹性反馈的影响就被最小化，并且一步之内的小扰动没有在塑性优化中捕获，这样的话会提高长期的性能。 —— 避免一次性的刺激，对整体的行为造成影响。

为了实现长期最优的行为，通过贝叶斯方法优化其全局优化能力、数据效率和噪声的鲁棒性。


对于能源效率，不包含在在成本函数中，但是能源效率是控制模式与自然动力学之间匹配程度增加的象征，


## 贝叶斯优化
贝叶斯优化是一种使用高斯核（**什么是高斯核**？论文中怎么设置的）进行函数逼近的黑盒优化方法，它是无模型、无导数的方法，已经应用于很多机器人优化方法。**贝叶斯优化的优缺点**
> 协方差表示了 $Y$ 之间有多近，$X$ 之间的相似性是怎么决定的呢。那 $X$ 之间怎么度量？**高斯核**它用来描述函数之间的相似度; 在这里用于描述 X 值之间的相似度，可以用于高斯过程回归，如果两个点之间距离较近，那他们之间的那些未知点的协方差也就越小，即根据已知点就越能确定该未知点。


**为什么采用贝叶斯优化？**
- 因为我们需要优化的参数维度比较低，贝叶斯优化比较适合处理低维度的超参数，而且贝叶斯方法的优点是收敛速度快（但是容易陷入局部最优）
- 我们希望CPG参数能对应最低的成本函数。但是很难对它们之间建立显示的函数，而贝叶斯定理可以很好的解决黑盒函数的问题。

**整个运行过程是怎样的？**
我们使用随机 CPG 先运行 15 个回合，这样有助于增加探索（尽可能的避免陷入局部最优解），我们根据运行的 15 个回合中进行采样几个已知点，然后对这些已知点通过高斯过程回归，计算未知点的均值和标准差（方差），通过采集函数来确定接下来要选取的位置点，然后不断迭代循环，直到找到满足我们要求的最优超参数。所以我们实际优化回合为135回合。
对于一个完整的回合，我们先让 Morti 运行 10s 后，在采集数据计算成本函数（10s），这样就可以在评估开始之前实现稳态步行行为，这样做的目的是减少前期的扰动对最后长期塑性匹配的影响。一个完整的回合就是20s。
>在这里贝叶斯方法使用基于 `skopt` 的 `gp_minimize` 优化器。在 Pybullet 仿真环境中，优化器使用成本函数评估每个回合（10 秒；大概 10 个周期）。Morti 首先步行 10s 后，将 CPG 从初始状态引入，从而在评估开始之前实现稳态行为。因此一个完整的回合需要 20s，在近似成本函数之前，我们使用随机 CPG 参数对 15 个回合进行采样，然后我们将采集函数设置为 `gp_hedge` 对 135 个回合进行优化。——**怎么利用skopt对贝叶斯函数进行优化。**

**为什么要降低短期扰动对我们长期塑性匹配的影响？**
因为短期弹性反馈是由于自然动力学和机械限制引起的，如果只是偶尔发生一次，他也可能会对成本函数造成较大的影响，但是这样的影响也只是短期偶尔发生的，并不能代表我们的超参数在长期运行中表现不好，因为我们最终的目标还是在希望在长期运行中表现的较好，而短期扰动我们可以通过预定义的短期弹性反馈来进行缓解。所以我们要尽量降低短期扰动对长期塑性匹配的影响。
**如何降低短期扰动对我们长期塑性匹配的影响？**
- 就是上面说的一个回合开始前，先让 Morti 运行 10s，10s 后大概就稳态运行了，这样评估时就尽量避免了利用弹性反馈的错误结果了
- 传感器采集数据的频率要低于整个控制回路采集数据计算成本函数的频率，即使在开始10s之后，也能尽可能减少的利用短期弹性反馈的干扰结果。

为了降低复杂性，将参数空间限制为 6 个参数：
$\Theta_{\text {hipOffset }}, \Theta_{\text {hipAmplitude }}, D_{\text {front }} D_{\text {hind }}, \delta_{\phi, \text { knee }}  \delta_{\text {overswing }}$
髋关节偏移、髋关节振幅、膝关节振幅、膝关节相位偏移、
更多的参数可能会更多的提升性能，但是也会导致更多的极端情况，优化器利用相应的成本函数也会出现很多不希望的步态特征（跳跃步态和在地面上的拖拽步态）。
![[综合/四足机器人/调研/img/Paper8_6.png]]

贝叶斯方法假设这个六个超参数与我们设计的成本函数之间存在一个函数关系。而目前机器学习其实是一个黑盒子 (black box), 即我们只知道 input 和 output，所以很难确直接定存在什么样的函数关系，但是我们的目标就是找到能使成本函数最小的那六个超参数的值。
因为我们的**目标**是获取能使成本函数最小值的六个超参数的值。
> 用于计算成本函数的输入虽然不是这六个超参数，但是他们输入是由这些超参数间接影响的。

再这里**成本函数就是我们的黑盒函数**，**自变量就是我们的超参数**（一个//多个），因变量就是成本函数的值。我们设定一个可以接受的最小值，得到超参数的结果就是让成本函数小于可接受值的（一个//多个）超参数。
> 因为这里用到的是多个超参数，可以通过（独立//相关）多元正态分布对其建模
   将六个参数一同组合做一个贝叶斯优化。
> 或者，髋关节的两个变量是相互影响的，可以将这两个参数组合做一个贝叶斯优化，膝关节的四个变量是相互影响的， 可以讲讲着四个参数组合做一个贝叶斯优化

贝叶斯优化方法的**输入**就是六个超参数的取值范围、我们预期成本函数能达到的最小值（不一定是全局最优的）
贝叶斯优化方法的**输出**就是满足（小于）我们预期成本函数的六个超参数值、以及其对应的成本函数值

这里包含两个函数：先验函数（高斯过程回归）用于根据已知点计算该所有未知点的均值和协方差；采集函数（下置信边界）用于根据计算的分布，选取我们下一次迭代的点。其中越靠近已知点的值，标准差越小，越是远离已知点，标准差越大，此时说明高斯过程回归对这个未知点越不确定。
> 这里借用了两个假设：
> - 给定一些 X 的值，对 Y 建模，此时假设对应的这些 Y 值服从一个联合高斯分布！
> - 如果两个X比较近，那么对应的Y也一定是比较接近。
![[综合/四足机器人 1/img/BO1.png]]

>x表示的是一个我们需要最终优化的超参数（即我们所需的六个超参数），在这里它不是真正意义的输入数据，在这里真正的输入数据是那五个成本信号。$f(x)$ 就是那个黑盒子，输入一组超参数，我们希望利用这些成本信号，不断优化$f(x)$,从而得到最优的六个超参数。


>贝叶斯方法就是通过优化这6个参数，用来优化CPG的模型，因此这六个参数也是CPG参数的组成部分，当前对于那些短期的干扰（通过传感器采集到的数据与CPG的预期的运动轨迹不一致），会通过弹性反馈短期内改变当前CPG的关节运动轨迹，但是因为采集数据的频率（500Hz）远高于传感器的采集频率，所以采样到短期扰动的情况也会减少。因此一些短期的扰动不会很影响长期优化的结果


### 成本函数
反馈成本项$J_{feedback}$ ：每一步中每条腿主动反馈的平均百分比
$$
J_{\text {feedback }}=\frac{1}{f n T} \sum_{n=0}^{4} \sum_{t=0}^{T} \mathbf{r}_{\mathrm{ETO}}+\mathbf{r}_{\mathrm{ETD}}+\mathbf{r}_{\mathrm{LTO}}+\mathbf{r}_{\mathrm{LTD}}
$$
> T: 评估时间；$\mathbf{r}_{\mathrm{ETO}}、\mathbf{r}_{\mathrm{ETD}}、\mathbf{r}_{\mathrm{LTO}}、\mathbf{r}_{\mathrm{LTD}}$ ：表示每个腿在特定反馈时的时间向量
> 减少了弹性反馈的数量，也就说明此时的参数与自然动力学更匹配。

距离成本项 $J_{distance}$ ：评估行驶距离，鼓励向前移动
$$
J_{\text {distance }}=\frac{1}{x_{\text {body }}}
$$
> $x_{\text {body }}$ 表示相对于初始位置当前行驶的距离；开始时可能会获得较大奖励，随着它不断掌握向前走后，就减少对它的奖励，让其他的成本函数占更大的比例，去学习更好的步态。

身体俯仰成本项 $J_{pitch}$ ：惩罚与指令步态特征的偏差，用于确保Morti 尽量减少前后晃动。（一个回合内）
$$
J_{\text {pitch }}=\left\|\max \left(\alpha_{\text {pitch }}\right)-\min \left(\alpha_{\text {pitch }}\right)\right\|
$$
>$\alpha_{\text {pitch }}$ 身体俯仰角

接触成本项 $J_{contact}$：每一步中腾空姿态变化的平均数量,用作惩罚，不希望表现出其他不希望的步态
$$
J_{\text {contact }}=\frac{1}{f n T} \sum_{n=0}^{4} \sum_{t=0}^{T}\left(\| \frac{\mathrm{d}}{\mathrm{dt}} \text { contact } \|>0\right)
$$
> contact 是四条腿接触传感器数据矩阵（4 · 12）。
> 作为不希望表现出的步态的惩罚项，通常只会在性能较差时才会有较大浮动。

周期成本项 $J_{periodicity}$：惩罚期望步态频率与测量的步态频率之间的差异，防止非周期性步态或多步步态。
$$
\begin{gathered}
S_{\text {pitch }}=\alpha_{\text {pitch }} \times \alpha_{\text {pitch }} \\
f_{\text {bodyPitch }}=\left\|\max S_{\text {pitch }}\right\| \\
J_{\text {periodicity }}=\sqrt{\frac{1}{N}\left(f_{\text {bodyPitch }}-f_{\mathrm{cpg}}\right)^{2}}
\end{gathered}
$$
> 作为不希望表现出的步态的惩罚项，通常只会在性能较差时才会有较大浮动。

弹性活动是可逆的，只有在扰动存在时才会活跃，就像弹簧只有在外力活跃时才会偏转，然后返回到其初始状态一样。可塑性（黄色）永久地改变系统行为，以适应来自环境的长期主动刺激。如果经常出现相同的扰动，系统就会适应该扰动。

在短期弹性反馈中：获取当前机器人的状态和脚步接触反馈信息，产生关节轨迹，进而通过关节控制器，对与 CPG 期望不匹配的运动进行调节。
在长期可塑性中：也会获取脚底接触反馈信息和弹性反馈活动的数量等信息组成一个成本信号，输入到贝叶斯优化器中，优化 CPG 的参数信息。
> 短期弹性反馈就相当于反射模块，如果机器人的当前的运动模式没有与CPG预期的运动模式失配的话是不会进行调控的，而在此期间也会通过贝叶斯优化CPG参数，使其表现的更好。刚开始时，机器人可能会表现的磕磕绊绊，因此此时CPG认为这样的动作是"正确的"，随着不断进行优化，贝叶斯的成本函数会不断的纠正这样的行为（磕磕绊绊速度肯定慢），进而让CPG参数得到优化，那么机器人表现的也就回更好。

弹性反馈活动通过来自脚底接触传感器的稀疏接触反馈来缓解短期扰动。为了量化控制模式与 Morti 自然动力学的匹配程度，我们使用弹性反馈活动（elastic feedback activity）作为代理，如果动态不匹配，则反馈机制必须不断进行干扰，来纠正 Morti 命令和行为之间的差异，控制模式的匹配需要可塑性的增加。为了提高塑性匹配，作者利用贝叶斯优化的方法，通过最小化弹性反馈活动的数量来优化生成控制模式的 CPG 参数，塑性地将 CPG 的控制模式与 Morti 的自然动力学相匹配。

![[综合/四足机器人/调研/img/Paper8_7.png]]



## 实验
先在模拟环境（Pybullet）中优化控制模式，仿真环境具有真实环境中类似的频率限制，在仿真环境优化后，将获得的最优参数集应用到硬件中，测试真实机器人的性能。并通过比较仿真和硬件实验来量化 sim2real 的差距来验证方法的可移植性。

在仿真环境中，经过 150 个回合（rollout）就可以学会以 0.3m/s 的速度进行走路，在 Inter i7 的 cpu 上，整个优化过程持续的时间大概为 1 小时。

![[综合/四足机器人/调研/img/Paper8_8.png]]

为了详细验证性能以及模拟和硬件部署之间的差异，下图展示了贝叶斯优化的成本函数，由于接触损耗、齿轮箱齿隙、摩擦和脚底传感器中的弹性，硬件机器人显示出较低的速度。

在整个优化过程，Morti 跌倒了 16 次，占整个回合输的 11%，主要集中前 15 个回合。

在仿真结果的性能要好于实体，为了验证产生这种差异的原因，
1. 首先作者在每个回合中对各成本因素进行了分析，发现没有单独一个成本因素对最后的结果产生较大的影响，而是实体中所有的成本因素都要略高于仿真环境，所以导致最后的硬件环境中的成本值要明显高于仿真环境。其中造成差异性较大的因素主要是：$J_{distance}$ ：距离成本项和 $J_{feedback}$ 反馈成本项，二者的周期成本$J_{periodicity}$、接触成本$J_{contact}$、身体俯仰成本$J_{pitch}$差异性较小。
2. 由于实体机器人接触损耗、齿轮箱齿隙、摩擦和脚底传感器中的弹性，硬件机器人显示出较低的速度，在触地的过程中，脚的不完美触地都会导致更高的反馈成本（成本值）
![[综合/四足机器人/调研/img/Paper8_2.png]]
- 通过动态匹配和 $J_{feedback}$ 的最小化，Morti 能够在给定的时间内行进更长的距离（通过提升的 $J_{distance}$ 体现）。
- $J_{pitch}$ 在整个优化的过程中变化的幅度比较小，这时因为 CPG 不会主动的控制身体的俯仰
-


为了验证控制模式与系统自然动力学相匹配，可以提高能源效率
首先对能源效率进行了量化（并且该能量效率并未算入成本函数中），计算了一个标准化扭矩作为作为性能的衡量标准：
$$
\tau_{\text {normal }}=\sum_{n=1}^{4} \frac{\left(\bar{\tau}_{\text {hip, } n}+\bar{\tau}_{\text {knee } n}\right)}{\bar{v}_{\text {body }}}
$$
之所以选择扭矩信号，首先它可以充分的代表系统的能量需求，而且扭矩信号没有较大的振荡，并且在模拟和硬件机器人中都方便测量，经过实验验证将控制模式与系统自然动力学相匹配，可以提高能源效率（相较于开始时降低了42%）。
![[综合/四足机器人/调研/img/Paper8_10.png]]







一般的机器人行走时，机器学习会通过大量计算，预先设计每条腿运动的细节，这会消耗大量的电量。但是Morti在走路跌倒后，可以根据新的算法结果，重新调整走路的角度。Morti通过这些反馈数据来学习行走方式，不需要进行大量计算。Morti可以在学习走路的过程中降低能量消耗。在Morti行走一个小时后，它消耗的能量比刚开始走路时减少了42%。


## 总结
本文主要研究了控制和传感器带宽有限的步行系统如何学习利用腿部力学中体现的智能。重点研究了被动机械结构和神经控制的协同作用。按时间范围分离反馈，我们在短期内实现了扰动缓解，同时量化了控制模式和自然动力学的失配。优化了系统的长期性能，并使控制器适应其机械系统。
Morti设计的被动行为， 能有使CPG控制结构能够有效利用腿部设计的自然动力学。运动控制器如果能有效被动顺应腿结构可以间接提高能量效率，通过最小化所需的弹性反馈活动，控制器塑性的学习控制模式和自然动力学之间的匹配。








————————————————————

该研究团队通过在机器人中建立一个模型，去学习反射和 CPG 运动
Morti 模仿动物学习走路过程，通过不断的跌倒翻滚，去学习掌握复杂的腿部力学，从而精确的调整腿部肌肉和肌腱。



为什么需要结合反射呢？
反射是由连接腿部传感器和脊髓的硬编码神经通路触发的无意识的运动控制行为。
> 当动物在正常行走时，CPG 可以很好的控制来自脊髓的运动信号，但是当它与地面进行碰撞时，就会改变他们的原来的运动模式，而这时，就需要它们自身的反射来发挥作用，协调整个运动模式，防止摔倒。这些运动信号是可逆的（具有弹性的），运动模式在受到调控后就会恢复到原来的形态。但是如果在多次循环运动后，仍然会磕磕绊绊，这时的运动模式就需要重新学习，并使其不可逆。就像是作者所说“如果动物跌倒了，这是一个错误吗？如果只发生一次，就不是错误。但是，如果它经常跌倒，就可以为我们提供一个衡量机器人行走能力的标准。”
> 


Morti 的虚拟脊髓放置在 Morti 的头部位置，Morti 在行走的过程中，足底传感数据不断与它自身的 CPG 预测的预期触地进行比较，如果机器人摔倒了，学习算法会改变腿前后摆动的距离、速度以及腿在地面上的长度。调整后的运动也会告诉 Morti 之后如何更好地利用腿部力学。在学习过程中，Morti 的 CPG 会发送适应的运动信号来优化自身行走，进而减少磕磕绊绊。
> 利用一种贝叶斯优化算法来指导机器狗学习：测量到的足部传感器信息与虚拟脊髓模型的目标数据相匹配，脊髓模型作为程序运行在机器人的“大脑”中。
> 机器人通过不断比较发送和期望的传感器信息、运行反射回路和调整其运动控制模式来学习行走。
> 
> 如果机器人摔倒了，学习算法会通过改变腿来回摆动的距离和速度来优化行走方式。在机器学习的过程中，CPG会发送一些自适应的运动信号，来让机器人行走得更平稳。该机器学习过程的核心就是要改变CPG的输出信号，并监测机器在什么情况下会遇到磕绊。

一般的机器人行走时，机器学习会通过大量计算，预先设计每条腿运动的细节，这会消耗大量的电量。但是Morti在走路跌倒后，可以根据新的算法结果，重新调整走路的角度。Morti通过这些反馈数据来学习行走方式，不需要进行大量计算。Morti可以在学习走路的过程中降低能量消耗。研究发现，在Morti行走一个小时后，它消耗的能量比刚开始走路时减少了42%。
>如果这种技术可以大规模使用，将会有两个好处：第一，机器学习会更加节能，消耗的能量更少。机器不必再根据大量的数据进行暴力计算，而是可以通过自主学习变得更加“聪明”。第二，这种技术可以为人工智能领域和生物领域的结合带来启发。









对此，Ruppert 解释说：“Morti 实际上并不知道它的腿部解剖结构以及它们是如何工作的。”

> 无模型：Morti 的虚拟脊髓并不了解自身的腿部设计、动力来源和身体结构。由于对自身物理结构一无所知，Morti 缺少一个机器人“模型”d
> 通过无模型的贝叶斯优化可塑性的最小了所需的弹性反馈活动。

在机器人技术中，CPG 常用作关节轨迹产生器和仿生肌肉激活模式产生器，CPG 在不了解系统动力学的情况下指导运动或肌肉激活的控制和协调。




>
> “因为研究动作的脊髓是比较复杂的，但我们可以在机器人中建立一个模型”，我们知道反射是内在的；但如何将两者结合起来，让动物学习反射和 CPG 运动？这是机器人与生物学交叉领域的基础性研究。针对生物学无法回答的问题，我们的机器人模型给出了答案。”在未来的工作中，研究团队将继续扩展 CPG，在产生臀部轨迹时将机体俯仰动作考虑其中。通过惯性测量装置，机体俯仰可以反馈到 CPG 中。

>为了量化控制模式与 Morti 自然动力学的匹配程度，通过使用弹性反馈活动（elastic feedback activate）作为代理（通过弹性反馈活动作为Morti自然动力学与控制模式之间不匹配的代理），如果动态不匹配，则反馈机制必须不断进行干预，纠正 Morti 命令和测量行为之间的差异。
>控制模式的匹配需要可塑性的增加，为了提高可塑性匹配，通过最小化弹性反馈活动的数量来优化生成控制模式的 CPG 参数



这种的反馈机制帮助Morti减轻了由动态不匹配引起的扰动。
> “CPG 类似于天然提供的内置自动行走智能，我们已经将其转移到机器人身上。计算机产生信号控制腿部的马达，机器人就会行走和跌倒。数据从传感器传到虚拟脊髓，与 CPG 数据进行对比。如果传感器数据与预期数据不匹配，学习算法就会改变行走行为，直到机器人走得很好，不会绊倒。学习过程的核心部分是改变 CPG 的输出，同时保持反应的活跃，并监测机器人的跌跌撞撞。”



柔顺腿力学
利用贝叶斯优化算法来指导四足机器人的学习，
该研究团队通过中枢模式发生器（central pattern generator (CPG)）来控制四足机器人 Mortic，


> 这种无模型的前馈模式与提供被动稳定性和鲁棒性的被动顺应腿设计结合使用效果很好，通过闭合CPG中的反馈回路，系统可以主动适应来自环境不可预见的影响。















创新：提出了针对被动弹性机器人的控制模式和复杂