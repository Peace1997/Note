##  简述：
**什么是 MPC 算法**
MPC 全称可指 Model Predictive Control 模型预测控制（又称 RHC, Receding Horizon ）。是一种控制模式（控制策略）

根据当前系统状态、模型以及约束，对相关控制量进行预测，得到系统未来的输出，将该输出与期望输出进行比较，判断该控制量的好坏，可以通过各种方法对控制量进行预测输出，以使预测的输出尽可能接近目标，同时满足约束条件。

MPC 的基本工作原理如下：

1. 首先，建立系统的动态模型。
2. 然后，定义控制目标和约束。
3. 接下来，预测未来一段时间内系统的状态和输出。
4. 最后，通过优化计算控制输入，以使预测的输出尽可能接近目标，同时满足约束条件。

**通过 MPC 算法完成什么样的任务**
已知当前系统状态和未来的参考系统状态，求解最优的系统控制输入（反作用力），即MPC在机器狗的运动控制中用来求解地面的反作用力。

**MPC 算法大概流程**：
先对机器人进行动力学建模（动力学微分建模），在对其进行约化，使其满足特定形式（凸性）；之后在对微分模型离散化，得出预测模型；最后通过QP（二次规划问题；二次函数）最优化问题，得到反作用力（控制输入）

**机器人在中如何使用 MPC 算法**
用到的数学工具就是微分和线性代数

**MPC 算法的优点和缺点**
算法频率比较低，控制存在一定的误差


## 基本概念
利用一个已有的模型、系统当前状态和未来的控制量，来预测系统未来的输出，然后与我们期望的系统输出做比较，得到一个损失函数：**
$$
损失函数= (未来输出 (模型，未来控制量，当前状态) - 期望输出) ^2 
$$
模型、当前状态、期望输出都是已知的，因此只有未来控制量一个自变量。采用二次规划的方法求解出某个未来控制量，使得损失函数最小，这个未来控制量的第一个元素就是当前控制周期的控制量。
 

**预测模型**：对未来一段时间内的输出进行预测；
- *预测时域*：预测未来多少个时间步长，表示控制器对未来状态的预测程度。
- *控制时域*：求解出多少组控制量（控制时域一般选为预测时域的10%到20%。）

**滚动优化**：滚动进行有限时域在线优化 (最优控制)；
> 最优控制：建立描述受控运动过程的运动方程，给出控制变量的允许取值范围，指定运动过程的初始状态和目标状态，并且规定一个评价运动过程品质优劣的性能指标，建立最优化问题的数学模型，在此基础上求出最优解。

**反馈校正**：通过预测误差反馈，修正预测模型，提高预测精度。





## MPC 在四足机器人中的应用
将四足机器人简化为单刚体后构建一个多点支撑的力平衡模型，通过 MPC 控制理论在线性假设下使用 QP 优化来求解。


## MPC 与 PID
**PID控制器**
$$
u\left( n \right) =k_p\left( err\left( n \right) +k_i\sum_{j=1}^n{err\left( j \right) +k_d\left( err\left( n \right) -err\left( n-1 \right) \right)} \right)
$$
不具前瞻性（仅有当前误差和历史误差，没有未来误差）、无模型控制（近根据目标状态和当前状态进行控制）
**MPC**
通过“控制时域”和“预测时域”